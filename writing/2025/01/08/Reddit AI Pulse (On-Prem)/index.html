<!DOCTYPE html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../../../../2024/12/15/recsys-challenge-2024-model-selection/ rel=prev><link href=../../23/Reddit%20AI%20Pulse%20%28Cloud%29/ rel=next><link rel=icon href=../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>From Reddit to Insights: Building an AI-Powered Data Pipeline with Gemini (On-Prem) - SulmanK Blog</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.ab4e12ef.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><script src=../../../../../assets/javascripts/glightbox.min.js></script><style id=glightbox-style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#from-reddit-to-insights-building-an-ai-powered-data-pipeline-with-gemini-on-prem class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title="SulmanK Blog" class="md-header__button md-logo" aria-label="SulmanK Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> SulmanK Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> From Reddit to Insights: Building an AI-Powered Data Pipeline with Gemini (On-Prem) </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/SulmanK/blog/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class=md-source__repository> blog </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../../ class=md-tabs__link> Writing </a> </li> <li class=md-tabs__item> <a href=../../../../../contact/ class=md-tabs__link> Contact </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title="SulmanK Blog" class="md-nav__button md-logo" aria-label="SulmanK Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> SulmanK Blog </label> <div class=md-nav__source> <a href=https://github.com/SulmanK/blog/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class=md-source__repository> blog </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__container"> <a href=../../../../ class="md-nav__link "> <span class=md-ellipsis> Writing </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../archive/2026/ class=md-nav__link> <span class=md-ellipsis> 2026 </span> </a> </li> <li class=md-nav__item> <a href=../../../../archive/2025/ class=md-nav__link> <span class=md-ellipsis> 2025 </span> </a> </li> <li class=md-nav__item> <a href=../../../../archive/2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../category/ai/ class=md-nav__link> <span class=md-ellipsis> AI </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/agent/ class=md-nav__link> <span class=md-ellipsis> Agent </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/agentic-workflow/ class=md-nav__link> <span class=md-ellipsis> Agentic Workflow </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/agents/ class=md-nav__link> <span class=md-ellipsis> Agents </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/benchmark/ class=md-nav__link> <span class=md-ellipsis> Benchmark </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/cloud-architecture/ class=md-nav__link> <span class=md-ellipsis> Cloud Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/data-engineering/ class=md-nav__link> <span class=md-ellipsis> Data Engineering </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/data-science/ class=md-nav__link> <span class=md-ellipsis> Data Science </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/deep-learning-recommendation-models/ class=md-nav__link> <span class=md-ellipsis> Deep Learning Recommendation Models </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/evaluation/ class=md-nav__link> <span class=md-ellipsis> Evaluation </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/exploratory-data-analysis/ class=md-nav__link> <span class=md-ellipsis> Exploratory Data Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/fastapi/ class=md-nav__link> <span class=md-ellipsis> FastAPI </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/full-stack/ class=md-nav__link> <span class=md-ellipsis> Full Stack </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/gcp/ class=md-nav__link> <span class=md-ellipsis> GCP </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/llm/ class=md-nav__link> <span class=md-ellipsis> LLM </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/llms/ class=md-nav__link> <span class=md-ellipsis> LLMs </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/ml/ class=md-nav__link> <span class=md-ellipsis> ML </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/machine-learning/ class=md-nav__link> <span class=md-ellipsis> Machine Learning </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/model-selection/ class=md-nav__link> <span class=md-ellipsis> Model Selection </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/music-technology/ class=md-nav__link> <span class=md-ellipsis> Music Technology </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/react/ class=md-nav__link> <span class=md-ellipsis> React </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/recsys-challenge-2024/ class=md-nav__link> <span class=md-ellipsis> RecSys Challenge 2024 </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/recommendation-systems/ class=md-nav__link> <span class=md-ellipsis> Recommendation Systems </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/recommender-systems/ class=md-nav__link> <span class=md-ellipsis> Recommender Systems </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/social-deduction/ class=md-nav__link> <span class=md-ellipsis> Social Deduction </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/terraform/ class=md-nav__link> <span class=md-ellipsis> Terraform </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/web-development/ class=md-nav__link> <span class=md-ellipsis> Web Development </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/cloud/ class=md-nav__link> <span class=md-ellipsis> cloud </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/end-to-end-pipeline/ class=md-nav__link> <span class=md-ellipsis> end-to-end pipeline </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../contact/ class=md-nav__link> <span class=md-ellipsis> Contact </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> <nav class=md-nav aria-label=Introduction> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-youll-learn class=md-nav__link> <span class=md-ellipsis> What You’ll Learn </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#system-architecture-modular-and-scalable-design class=md-nav__link> <span class=md-ellipsis> System Architecture: Modular and Scalable Design </span> </a> <nav class=md-nav aria-label="System Architecture: Modular and Scalable Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-data-collection-layer class=md-nav__link> <span class=md-ellipsis> 1. Data Collection Layer </span> </a> </li> <li class=md-nav__item> <a href=#2-storage-layer class=md-nav__link> <span class=md-ellipsis> 2. Storage Layer </span> </a> </li> <li class=md-nav__item> <a href=#3-processing-layer class=md-nav__link> <span class=md-ellipsis> 3. Processing Layer </span> </a> </li> <li class=md-nav__item> <a href=#4-orchestration-layer class=md-nav__link> <span class=md-ellipsis> 4. Orchestration Layer </span> </a> </li> <li class=md-nav__item> <a href=#5-observability-layer class=md-nav__link> <span class=md-ellipsis> 5. Observability Layer </span> </a> </li> <li class=md-nav__item> <a href=#6-presentation-layer class=md-nav__link> <span class=md-ellipsis> 6. Presentation Layer </span> </a> </li> <li class=md-nav__item> <a href=#deep-dive-key-components class=md-nav__link> <span class=md-ellipsis> Deep Dive: Key Components </span> </a> <nav class=md-nav aria-label="Deep Dive: Key Components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reddit-data-collection-and-preprocessing class=md-nav__link> <span class=md-ellipsis> Reddit Data Collection and Preprocessing </span> </a> <nav class=md-nav aria-label="Reddit Data Collection and Preprocessing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-data-collection-with-praw class=md-nav__link> <span class=md-ellipsis> 1. Data Collection with PRAW </span> </a> </li> <li class=md-nav__item> <a href=#2-data-preprocessing-with-pyspark class=md-nav__link> <span class=md-ellipsis> 2. Data Preprocessing with PySpark </span> </a> <nav class=md-nav aria-label="2. Data Preprocessing with PySpark"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#posts-processing class=md-nav__link> <span class=md-ellipsis> Posts Processing </span> </a> </li> <li class=md-nav__item> <a href=#comments-processing class=md-nav__link> <span class=md-ellipsis> Comments Processing </span> </a> </li> <li class=md-nav__item> <a href=#processed-data-schema class=md-nav__link> <span class=md-ellipsis> Processed Data Schema </span> </a> </li> <li class=md-nav__item> <a href=#daily-summary-processing class=md-nav__link> <span class=md-ellipsis> Daily Summary Processing </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dbt class=md-nav__link> <span class=md-ellipsis> dbt </span> </a> <nav class=md-nav aria-label=dbt> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dbt-data-transformations class=md-nav__link> <span class=md-ellipsis> DBT Data Transformations </span> </a> </li> <li class=md-nav__item> <a href=#dbt-data-quality-tests class=md-nav__link> <span class=md-ellipsis> DBT Data Quality Tests </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#text-processing-pipeline class=md-nav__link> <span class=md-ellipsis> Text Processing Pipeline </span> </a> <nav class=md-nav aria-label="Text Processing Pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-text-summarization class=md-nav__link> <span class=md-ellipsis> 1. Text Summarization </span> </a> </li> <li class=md-nav__item> <a href=#2-sentiment-analysis class=md-nav__link> <span class=md-ellipsis> 2. Sentiment Analysis </span> </a> </li> <li class=md-nav__item> <a href=#3-pipeline-integration class=md-nav__link> <span class=md-ellipsis> 3. Pipeline Integration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#gemini-ai-analysis class=md-nav__link> <span class=md-ellipsis> Gemini AI Analysis </span> </a> <nav class=md-nav aria-label="Gemini AI Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-analysis-configuration class=md-nav__link> <span class=md-ellipsis> 1. Analysis Configuration </span> </a> </li> <li class=md-nav__item> <a href=#2-data-processing class=md-nav__link> <span class=md-ellipsis> 2. Data Processing </span> </a> </li> <li class=md-nav__item> <a href=#3-output-formatting class=md-nav__link> <span class=md-ellipsis> 3. Output Formatting </span> </a> </li> <li class=md-nav__item> <a href=#4-pipeline-integration class=md-nav__link> <span class=md-ellipsis> 4. Pipeline Integration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#web-application class=md-nav__link> <span class=md-ellipsis> Web Application </span> </a> <nav class=md-nav aria-label="Web Application"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#automated-deployment class=md-nav__link> <span class=md-ellipsis> Automated Deployment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#orchestrator-stack class=md-nav__link> <span class=md-ellipsis> Orchestrator Stack </span> </a> <nav class=md-nav aria-label="Orchestrator Stack"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-airflow-configuration class=md-nav__link> <span class=md-ellipsis> 1. Airflow Configuration </span> </a> </li> <li class=md-nav__item> <a href=#2-pipeline-structure class=md-nav__link> <span class=md-ellipsis> 2. Pipeline Structure </span> </a> </li> <li class=md-nav__item> <a href=#3-task-dependencies class=md-nav__link> <span class=md-ellipsis> 3. Task Dependencies </span> </a> </li> <li class=md-nav__item> <a href=#4-integration-points class=md-nav__link> <span class=md-ellipsis> 4. Integration Points </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#observability-stack class=md-nav__link> <span class=md-ellipsis> Observability Stack </span> </a> <nav class=md-nav aria-label="Observability Stack"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-metrics-collection-architecture class=md-nav__link> <span class=md-ellipsis> 1. Metrics Collection Architecture </span> </a> </li> <li class=md-nav__item> <a href=#2-task-specific-metrics class=md-nav__link> <span class=md-ellipsis> 2. Task-Specific Metrics </span> </a> </li> <li class=md-nav__item> <a href=#3-performance-dashboards class=md-nav__link> <span class=md-ellipsis> 3. Performance Dashboards </span> </a> </li> <li class=md-nav__item> <a href=#4-mlflow-integration class=md-nav__link> <span class=md-ellipsis> 4. MLflow Integration </span> </a> </li> <li class=md-nav__item> <a href=#5-alert-configuration class=md-nav__link> <span class=md-ellipsis> 5. Alert Configuration </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#results-and-impact class=md-nav__link> <span class=md-ellipsis> Results and Impact </span> </a> </li> <li class=md-nav__item> <a href=#future-improvements class=md-nav__link> <span class=md-ellipsis> Future Improvements </span> </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> <li class=md-nav__item> <a href=#resources-and-references class=md-nav__link> <span class=md-ellipsis> Resources and References </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content md-content--post" data-md-component=content> <div class="md-sidebar md-sidebar--post" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class="md-sidebar__inner md-post"> <nav class="md-nav md-nav--primary"> <div class=md-post__back> <div class="md-nav__title md-nav__container"> <a href=../../../../ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> <span class=md-ellipsis> Back to index </span> </a> </div> </div> <div class="md-post__authors md-typeset"> <div class="md-profile md-post__profile"> <span class="md-author md-author--long"> <img src="https://avatars.githubusercontent.com/u/43801845?v=4" alt="Sulman Khan"> </span> <span class=md-profile__description> <strong> <a href=https://github.com/SulmanK>Sulman Khan</a> </strong> <br> Creator </span> </div> </div> <ul class="md-post__meta md-nav__list"> <li class="md-nav__item md-nav__item--section"> <div class=md-post__title> <span class=md-ellipsis> Metadata </span> </div> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"></path></svg> <time datetime="2025-01-08 00:00:00+00:00" class=md-ellipsis>2025/01/08</time> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"></path></svg> <span class=md-ellipsis> in <a href=../../../../category/ai/ >AI</a>, <a href=../../../../category/data-engineering/ >Data Engineering</a>, <a href=../../../../category/llms/ >LLMs</a>, <a href=../../../../category/end-to-end-pipeline/ >end-to-end pipeline</a>, <a href=../../../../category/ml/ >ML</a></span> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"></path></svg> <span class=md-ellipsis> 18 min read </span> </div> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <article class="md-content__inner md-typeset"> <a href=https://github.com/SulmanK/blog/edit/master/docs/writing/posts/reddit_text_insight_sentiment_local.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg> </a> <a href=https://github.com/SulmanK/blog/raw/master/docs/writing/posts/reddit_text_insight_sentiment_local.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"></path></svg> </a> <h1 id=from-reddit-to-insights-building-an-ai-powered-data-pipeline-with-gemini-on-prem>From Reddit to Insights: Building an AI-Powered Data Pipeline with Gemini (On-Prem)<a class=headerlink href=#from-reddit-to-insights-building-an-ai-powered-data-pipeline-with-gemini-on-prem title="Permanent link">¶</a></h1> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">¶</a></h2> <div class="admonition abstract"> <p class=admonition-title>Purpose</p> <p>In this blog post, I document the process of building an AI-driven, on-premises data pipeline to automate this task. Using Google’s Gemini AI, the pipeline collects, processes, and synthesizes discussions from AI-related subreddits into structured daily reports. The system is designed to filter out irrelevant or harmful content, ensuring the extracted insights are both meaningful and actionable.</p> <p>Check out the <a href=https://github.com/SulmanK/reddit_ai_pulse_local_public>project GitHub repository</a> for the full code and detailed documentation and <a href=https://reddit-ai-pulse.vercel.app/ >Web Application</a>.</p> <!-- more --> </div> <div class="admonition info"> <p class=admonition-title>Problem Statement</p> <p>The field of artificial intelligence and machine learning evolves at an unprecedented pace, with new breakthroughs, trends, and discussions emerging daily. Platforms like Reddit host vibrant AI-focused communities that are rich with valuable insights. However, manually monitoring multiple subreddits to extract meaningful information is both time-consuming and inefficient.</p> </div> <h3 id=what-youll-learn><strong>What You’ll Learn</strong><a class=headerlink href=#what-youll-learn title="Permanent link">¶</a></h3> <ul> <li><strong>Designing a robust data pipeline orchestrated with Airflow</strong>: How to automate and orchestrate complex data workflows. </li> <li><strong>Optimizing data flow with PostgreSQL and dbt</strong>: Best practices for structuring and managing collected data efficiently. </li> <li><strong>Applying AI for sentiment analysis and summarization</strong>: Techniques to extract concise insights from unstructured Reddit discussions. </li> <li><strong>Utilizing Google’s Gemini AI for content analysis</strong>: Insights into leveraging advanced AI models to categorize and interpret data. </li> </ul> <h2 id=system-architecture-modular-and-scalable-design>System Architecture: Modular and Scalable Design<a class=headerlink href=#system-architecture-modular-and-scalable-design title="Permanent link">¶</a></h2> <p>Our pipeline is designed with modularity and scalability in mind, comprising six main layers. Below is a high-level overview of how the components interact:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../../../../img/reddit_ai_pulse_on_prem_pipeline.png data-title="Pipeline Architecture Diagram" data-desc-position=bottom><img alt="Pipeline Architecture Diagram" src=../../../../img/reddit_ai_pulse_on_prem_pipeline.png></a></p> <p>The diagram above illustrates the flow of data through our system, from collection to presentation. Each layer has specific responsibilities and communicates with adjacent layers through well-defined interfaces.</p> <hr> <h3 id=1-data-collection-layer>1. Data Collection Layer<a class=headerlink href=#1-data-collection-layer title="Permanent link">¶</a></h3> <ul> <li><strong>Reddit API Integration</strong>:<ul> <li>Fetch posts and comments from AI-focused subreddits.</li> </ul> </li> <li><strong>Text Preprocessing and Cleaning</strong>:<ul> <li>Separate processing pipelines for posts and comments.</li> <li>Remove special characters and formatting.</li> </ul> </li> <li><strong>Content Validation and Filtering</strong>: <ul> <li>Ensure only relevant and high-quality data is processed.</li> </ul> </li> <li><strong>Rate Limiting and Error Handling</strong>: <ul> <li>Manage API limits.</li> </ul> </li> <li><strong>DBT Transformations</strong>:<ul> <li>Stage posts and comments for further processing.</li> <li>Clean and standardize data structures.</li> <li>Manage processing state for each pipeline run.</li> <li>Automate cleanup upon pipeline completion.</li> </ul> </li> </ul> <hr> <h3 id=2-storage-layer>2. Storage Layer<a class=headerlink href=#2-storage-layer title="Permanent link">¶</a></h3> <ul> <li><strong>PostgreSQL Database</strong>: <ul> <li>Structured data storage with the following tables:<ul> <li>Raw data tables for posts and comments.</li> <li>DBT staging tables for processing queues.</li> <li>Processed results tables for analysis outputs.</li> </ul> </li> </ul> </li> <li><strong>Organized File System</strong>:<ul> <li>Store analysis outputs in a structured and accessible manner.</li> </ul> </li> <li><strong>Data Versioning and Backup</strong>:<ul> <li>Implement robust strategies for data integrity and recovery.</li> </ul> </li> </ul> <hr> <h3 id=3-processing-layer>3. Processing Layer<a class=headerlink href=#3-processing-layer title="Permanent link">¶</a></h3> <ul> <li><strong>Text Summarization</strong>: Generate concise summaries of discussions.</li> <li><strong>Sentiment Analysis</strong>: Extract emotional context from posts and comments.</li> <li><strong>Gemini AI Integration</strong>: Perform comprehensive content analysis using LLMs.</li> </ul> <hr> <h3 id=4-orchestration-layer>4. Orchestration Layer<a class=headerlink href=#4-orchestration-layer title="Permanent link">¶</a></h3> <ul> <li><strong>Airflow DAGs</strong>: Manage pipeline workflows efficiently.</li> <li><strong>Scheduled Task Execution</strong>: Automate task triggers based on predefined schedules.</li> <li><strong>Monitoring and Error Handling</strong>: Ensure reliability through automated checks.</li> </ul> <hr> <h3 id=5-observability-layer>5. Observability Layer<a class=headerlink href=#5-observability-layer title="Permanent link">¶</a></h3> <ul> <li><strong>Grafana Dashboards</strong>: Provide real-time monitoring of pipeline health and performance.</li> <li><strong>Prometheus Metrics Collection</strong>: Gather and analyze system metrics.</li> <li><strong>MLflow</strong>: Track machine learning experiments and maintain a model registry.</li> </ul> <hr> <h3 id=6-presentation-layer>6. Presentation Layer<a class=headerlink href=#6-presentation-layer title="Permanent link">¶</a></h3> <ul> <li><strong>React-Based Web Application</strong>: Present insights through an interactive user interface.</li> <li><strong>Automated Deployment</strong>: Streamline updates using GitHub Actions.</li> <li><strong>Real-Time Data Synchronization</strong>: Provides updates in batches (daily updates) to ensure users receive timely insights.</li> <li><strong>Interactive Visualizations</strong>: Enable dynamic exploration of AI-related discussions.</li> </ul> <hr> <p>This modular design ensures adaptability, maintainability, and scalability, enabling seamless interaction between components and the efficient transformation of Reddit data into actionable insights.</p> <h3 id=deep-dive-key-components>Deep Dive: Key Components<a class=headerlink href=#deep-dive-key-components title="Permanent link">¶</a></h3> <h4 id=reddit-data-collection-and-preprocessing>Reddit Data Collection and Preprocessing<a class=headerlink href=#reddit-data-collection-and-preprocessing title="Permanent link">¶</a></h4> <p>The foundation of our pipeline is reliable data collection and preprocessing. We utilize Python's Reddit API wrapper (PRAW) to fetch posts and comments from specified subreddits, with immediate text preprocessing for clean data storage.</p> <h5 id=1-data-collection-with-praw>1. Data Collection with PRAW<a class=headerlink href=#1-data-collection-with-praw title="Permanent link">¶</a></h5> <p>The Reddit client implementation focuses on efficient and reliable data collection. Here's how we handle both posts and their comments:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span><span class=w> </span><span class=nf>fetch_and_save_posts</span><span class=p>(</span><span class=n>reddit</span><span class=p>,</span> <span class=n>subreddit_name</span><span class=p>,</span> <span class=n>db_utils</span><span class=p>,</span> <span class=n>conn</span><span class=p>):</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>"""Fetches new posts from a subreddit since the last processed timestamp."""</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    <span class=n>last_processed_utc</span> <span class=o>=</span> <span class=n>get_last_processed_timestamp</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>subreddit_name</span><span class=p>)</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=n>current_max_utc</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    <span class=n>subreddit</span> <span class=o>=</span> <span class=n>reddit</span><span class=o>.</span><span class=n>subreddit</span><span class=p>(</span><span class=n>subreddit_name</span><span class=p>)</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=k>for</span> <span class=n>submission</span> <span class=ow>in</span> <span class=n>subreddit</span><span class=o>.</span><span class=n>hot</span><span class=p>(</span><span class=n>limit</span><span class=o>=</span><span class=mi>20</span><span class=p>):</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>        <span class=c1># Skip already processed posts</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>        <span class=k>if</span> <span class=n>submission</span><span class=o>.</span><span class=n>created_utc</span> <span class=o>&lt;=</span> <span class=n>last_processed_utc</span><span class=p>:</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>            <span class=k>continue</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>        <span class=c1># Process post data</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>        <span class=n>post_data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>            <span class=s2>"subreddit"</span><span class=p>:</span> <span class=n>subreddit_name</span><span class=p>,</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>            <span class=s2>"post_id"</span><span class=p>:</span> <span class=n>submission</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>            <span class=s2>"title"</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>submission</span><span class=o>.</span><span class=n>title</span><span class=p>),</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>            <span class=s2>"author"</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>submission</span><span class=o>.</span><span class=n>author</span><span class=p>),</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>            <span class=s2>"url"</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>submission</span><span class=o>.</span><span class=n>url</span><span class=p>),</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>            <span class=s2>"score"</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>submission</span><span class=o>.</span><span class=n>score</span><span class=p>),</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>            <span class=s2>"created_utc"</span><span class=p>:</span> <span class=n>submission</span><span class=o>.</span><span class=n>created_utc</span><span class=p>,</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>            <span class=s2>"comments"</span><span class=p>:</span> <span class=p>[]</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>        <span class=p>}</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>        <span class=c1># Handle comments if they exist</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>        <span class=k>if</span> <span class=n>submission</span><span class=o>.</span><span class=n>num_comments</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>                <span class=n>submission</span><span class=o>.</span><span class=n>comments</span><span class=o>.</span><span class=n>replace_more</span><span class=p>(</span><span class=n>limit</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># Expand comment tree</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>                <span class=n>post_data</span><span class=p>[</span><span class=s2>"comments"</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>                    <span class=p>{</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>                        <span class=s2>"comment_id"</span><span class=p>:</span> <span class=n>comment</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a>                        <span class=s2>"author"</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>comment</span><span class=o>.</span><span class=n>author</span><span class=p>),</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>                        <span class=s2>"body"</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>comment</span><span class=o>.</span><span class=n>body</span><span class=p>),</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a>                        <span class=s2>"created_utc"</span><span class=p>:</span> <span class=n>comment</span><span class=o>.</span><span class=n>created_utc</span><span class=p>,</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a>                    <span class=p>}</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>                    <span class=k>for</span> <span class=n>comment</span> <span class=ow>in</span> <span class=n>submission</span><span class=o>.</span><span class=n>comments</span><span class=o>.</span><span class=n>list</span><span class=p>()[:</span><span class=mi>10</span><span class=p>]</span>  <span class=c1># Top 10 comments</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a>                    <span class=k>if</span> <span class=n>comment</span><span class=o>.</span><span class=n>created_utc</span> <span class=o>&gt;</span> <span class=n>last_processed_utc</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a>                <span class=p>]</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a>                <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Error fetching comments for post </span><span class=si>{</span><span class=n>submission</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a>        <span class=c1># Save to database</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a>        <span class=n>db_utils</span><span class=o>.</span><span class=n>insert_raw_post_data</span><span class=p>(</span><span class=n>conn</span><span class=p>,</span> <span class=n>post_data</span><span class=p>)</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a>        <span class=n>current_max_utc</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>current_max_utc</span><span class=p>,</span> <span class=n>submission</span><span class=o>.</span><span class=n>created_utc</span><span class=p>)</span>
</span></code></pre></div> <p>The raw data is stored in PostgreSQL with the following schema:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>-- Raw posts table schema</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>raw_data</span><span class=p>.</span><span class=n>raw_posts</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>    </span><span class=n>subreddit</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=n>post_id</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=n>title</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=n>author</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>    </span><span class=n>url</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=n>score</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>    </span><span class=n>created_utc</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=k>TIME</span><span class=w> </span><span class=k>ZONE</span><span class=p>,</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=n>comments</span><span class=w> </span><span class=n>JSONB</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Stores comment data as JSON</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>    </span><span class=n>processed</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>FALSE</span><span class=p>,</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>    </span><span class=n>inserted_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=k>TIME</span><span class=w> </span><span class=k>ZONE</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=p>);</span>
</span></code></pre></div> <p>Our system is designed for efficient and reliable data processing. We use incremental data collection, fetching only new data based on timestamps. To manage the volume of Reddit data, we focus on the top 10 comments per post, allowing us to process approximately 1,000 comments daily in about 50 minutes. This can be easily scaled by adding more compute resources. We store comments in JSONB format, which provides flexibility for handling semi-structured data.</p> <p>We've implemented robust error handling with retry mechanisms and transaction management to ensure data consistency. Batch processing is used to improve scalability and efficiency when dealing with large datasets. While stream processing could further enhance scalability, we opted for batch processing for this use case.</p> <p>JSONB storage was chosen for its ability to handle semi-structured data like Reddit comments, which often vary in format and content. By storing comments as JSONB, the system accommodates diverse data structures without rigid schemas, while still allowing efficient querying and indexing for analytics.</p> <h5 id=2-data-preprocessing-with-pyspark>2. Data Preprocessing with PySpark<a class=headerlink href=#2-data-preprocessing-with-pyspark title="Permanent link">¶</a></h5> <p>To ensure the quality of our analysis, we implement a series of preprocessing steps for Reddit posts using PySpark. The following code snippet demonstrates how we filter and clean post titles:</p> <h6 id=posts-processing>Posts Processing<a class=headerlink href=#posts-processing title="Permanent link">¶</a></h6> <p>The following code snippet demonstrates how we parse, filter, and clean posts: </p><div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>def</span><span class=w> </span><span class=nf>preprocess_posts</span><span class=p>(</span><span class=n>df</span><span class=p>):</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>    </span><span class=sd>"""Preprocesses Reddit posts with content filtering and cleaning."""</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    <span class=c1># Content filtering patterns</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    <span class=n>profanity_pattern</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>'(?i)\b(wordword2|word3|word4|word5)\b|'</span> <span class=o>+</span> \
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>                       <span class=sa>r</span><span class=s1>'(?i)\b(w\*\*d1|w\*rd2|w\*rd3|w\*\*d4)\b|'</span> <span class=o>+</span> \
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>                       <span class=sa>r</span><span class=s1>'(?i)w[^\w]?r[^\w]?d1|'</span> <span class=o>+</span> \
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>                       <span class=sa>r</span><span class=s1>'(?i)w[^\w]?r[^\w]?d2'</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>    <span class=c1># Filter and clean posts</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>    <span class=k>return</span> <span class=n>df</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>        <span class=c1># Basic validation</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>        <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"title"</span><span class=p>)</span><span class=o>.</span><span class=n>isNotNull</span><span class=p>())</span> <span class=o>&amp;</span> 
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>        <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"title"</span><span class=p>)</span> <span class=o>!=</span> <span class=s2>""</span><span class=p>)</span> <span class=o>&amp;</span> 
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>        <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"title"</span><span class=p>)</span> <span class=o>!=</span> <span class=s2>"[deleted]"</span><span class=p>)</span> <span class=o>&amp;</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>        <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"author"</span><span class=p>)</span><span class=o>.</span><span class=n>isNotNull</span><span class=p>())</span> <span class=o>&amp;</span> 
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>        <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"author"</span><span class=p>)</span> <span class=o>!=</span> <span class=s2>"[deleted]"</span><span class=p>)</span> <span class=o>&amp;</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>        <span class=c1># Content filtering</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>        <span class=o>~</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"title"</span><span class=p>)</span><span class=o>.</span><span class=n>rlike</span><span class=p>(</span><span class=n>profanity_pattern</span><span class=p>)</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>    <span class=p>)</span><span class=o>.</span><span class=n>withColumn</span><span class=p>(</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>        <span class=c1># Clean and normalize text</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>        <span class=s2>"title"</span><span class=p>,</span> <span class=n>F</span><span class=o>.</span><span class=n>regexp_replace</span><span class=p>(</span><span class=s2>"title"</span><span class=p>,</span> <span class=sa>r</span><span class=s1>'[\n\r\t]'</span><span class=p>,</span> <span class=s1>' '</span><span class=p>)</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>    <span class=p>)</span><span class=o>.</span><span class=n>withColumn</span><span class=p>(</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>        <span class=c1># Remove multiple spaces</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>        <span class=s2>"title"</span><span class=p>,</span> <span class=n>F</span><span class=o>.</span><span class=n>regexp_replace</span><span class=p>(</span><span class=s2>"title"</span><span class=p>,</span> <span class=sa>r</span><span class=s1>'\s+'</span><span class=p>,</span> <span class=s1>' '</span><span class=p>)</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>    <span class=p>)</span><span class=o>.</span><span class=n>dropDuplicates</span><span class=p>([</span><span class=s2>"post_id"</span><span class=p>])</span>
</span></code></pre></div> Our post preprocessing involves several key steps: we filter out offensive content using regular expressions, validate the <code>title</code> and <code>author</code> fields, clean and normalize the text, and remove duplicate posts. This ensures our analysis is based on clean and relevant data.<p></p> <h6 id=comments-processing>Comments Processing<a class=headerlink href=#comments-processing title="Permanent link">¶</a></h6> <p>Similar to posts, we also preprocess Reddit comments to ensure data quality. The following code snippet demonstrates how we parse, filter, and clean comments stored in JSONB format:</p> <p></p><div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>def</span><span class=w> </span><span class=nf>preprocess_comments</span><span class=p>(</span><span class=n>df</span><span class=p>):</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>    </span><span class=sd>"""Preprocesses Reddit comments with content filtering and cleaning."""</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=c1># Parse and explode comments from JSONB</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=n>comments_schema</span> <span class=o>=</span> <span class=n>ArrayType</span><span class=p>(</span><span class=n>StructType</span><span class=p>([</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>        <span class=n>StructField</span><span class=p>(</span><span class=s2>"body"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>        <span class=n>StructField</span><span class=p>(</span><span class=s2>"author"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>        <span class=n>StructField</span><span class=p>(</span><span class=s2>"comment_id"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>        <span class=n>StructField</span><span class=p>(</span><span class=s2>"created_utc"</span><span class=p>,</span> <span class=n>DoubleType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>)</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>    <span class=p>]))</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>    <span class=k>return</span> <span class=n>df</span><span class=o>.</span><span class=n>withColumn</span><span class=p>(</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>        <span class=s2>"comments_parsed"</span><span class=p>,</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>        <span class=n>F</span><span class=o>.</span><span class=n>from_json</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comments"</span><span class=p>),</span> <span class=n>comments_schema</span><span class=p>)</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>    <span class=p>)</span><span class=o>.</span><span class=n>withColumn</span><span class=p>(</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>        <span class=s2>"comment"</span><span class=p>,</span> <span class=n>F</span><span class=o>.</span><span class=n>explode</span><span class=p>(</span><span class=s2>"comments_parsed"</span><span class=p>)</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>    <span class=p>)</span><span class=o>.</span><span class=n>select</span><span class=p>(</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>        <span class=s2>"post_id"</span><span class=p>,</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>        <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comment.body"</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"body"</span><span class=p>),</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>        <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comment.author"</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"author"</span><span class=p>),</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>        <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comment.comment_id"</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"comment_id"</span><span class=p>),</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>        <span class=n>F</span><span class=o>.</span><span class=n>to_timestamp</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comment.created_utc"</span><span class=p>))</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"created_utc"</span><span class=p>)</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>    <span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>        <span class=c1># Remove deleted/empty comments</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>        <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"body"</span><span class=p>)</span><span class=o>.</span><span class=n>isNotNull</span><span class=p>())</span> <span class=o>&amp;</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>        <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"body"</span><span class=p>)</span> <span class=o>!=</span> <span class=s2>""</span><span class=p>)</span> <span class=o>&amp;</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>        <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"body"</span><span class=p>)</span> <span class=o>!=</span> <span class=s2>"[deleted]"</span><span class=p>)</span> <span class=o>&amp;</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a>        <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"author"</span><span class=p>)</span> <span class=o>!=</span> <span class=s2>"[deleted]"</span><span class=p>)</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>    <span class=p>)</span><span class=o>.</span><span class=n>withColumn</span><span class=p>(</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>        <span class=c1># Clean and normalize text</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>        <span class=s2>"body"</span><span class=p>,</span> <span class=n>F</span><span class=o>.</span><span class=n>regexp_replace</span><span class=p>(</span><span class=s2>"body"</span><span class=p>,</span> <span class=sa>r</span><span class=s1>'[\n\r\t]'</span><span class=p>,</span> <span class=s1>' '</span><span class=p>)</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>    <span class=p>)</span><span class=o>.</span><span class=n>withColumn</span><span class=p>(</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>        <span class=c1># Remove multiple spaces</span>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a>        <span class=s2>"body"</span><span class=p>,</span> <span class=n>F</span><span class=o>.</span><span class=n>regexp_replace</span><span class=p>(</span><span class=s2>"body"</span><span class=p>,</span> <span class=sa>r</span><span class=s1>'\s+'</span><span class=p>,</span> <span class=s1>' '</span><span class=p>)</span>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>    <span class=p>)</span><span class=o>.</span><span class=n>dropDuplicates</span><span class=p>([</span><span class=s2>"comment_id"</span><span class=p>])</span>
</span></code></pre></div> Our comment preprocessing involves defining a schema for the JSONB data, parsing and exploding the comments, selecting and aliasing relevant fields (including converting the timestamp), filtering out invalid comments, cleaning and normalizing the text, and removing duplicates.<p></p> <h6 id=processed-data-schema>Processed Data Schema<a class=headerlink href=#processed-data-schema title="Permanent link">¶</a></h6> <p>The cleaned data is stored in separate tables for posts and comments:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1>-- Processed posts schema</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>processed_data</span><span class=p>.</span><span class=n>posts</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=n>subreddit</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>    </span><span class=n>post_id</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>    </span><span class=n>title</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>    </span><span class=n>author</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>    </span><span class=n>url</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>    </span><span class=n>score</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>    </span><span class=n>created_utc</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=k>TIME</span><span class=w> </span><span class=k>ZONE</span><span class=p>,</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>    </span><span class=n>processed_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=k>TIME</span><span class=w> </span><span class=k>ZONE</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=p>);</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=c1>-- Processed comments schema</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>processed_data</span><span class=p>.</span><span class=n>comments</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>    </span><span class=n>post_id</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>processed_data</span><span class=p>.</span><span class=n>posts</span><span class=p>(</span><span class=n>post_id</span><span class=p>),</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=w>    </span><span class=n>comment_id</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=w>    </span><span class=n>body</span><span class=w> </span><span class=nb>TEXT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=w>    </span><span class=n>author</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=w>    </span><span class=n>created_utc</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=k>TIME</span><span class=w> </span><span class=k>ZONE</span><span class=p>,</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=w>    </span><span class=n>processed_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=k>TIME</span><span class=w> </span><span class=k>ZONE</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=p>);</span>
</span></code></pre></div> <h6 id=daily-summary-processing>Daily Summary Processing<a class=headerlink href=#daily-summary-processing title="Permanent link">¶</a></h6> <p>After preprocessing, we generate daily summaries of the Reddit data using PySpark. The following code snippet demonstrates how we load, filter, and join posts and comments to create these summaries:</p> <p></p><div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>def</span><span class=w> </span><span class=nf>generate_daily_summaries</span><span class=p>(</span><span class=n>spark</span><span class=p>):</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>    </span><span class=sd>"""Generates daily summaries of the processed data using PySpark."""</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=n>current_timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>last_processed</span> <span class=o>=</span> <span class=n>get_last_processed_timestamp</span><span class=p>(</span><span class=n>spark</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=n>total_summaries_added</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>    <span class=k>for</span> <span class=n>subreddit</span> <span class=ow>in</span> <span class=n>SUBREDDITS</span><span class=p>:</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>        <span class=c1># Load posts and comments tables</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>        <span class=n>posts_df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>"jdbc"</span><span class=p>)</span> \
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>            <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>"url"</span><span class=p>,</span> <span class=n>jdbc_url</span><span class=p>)</span> \
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>            <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>"dbtable"</span><span class=p>,</span> <span class=sa>f</span><span class=s2>"processed_data.posts_</span><span class=si>{</span><span class=n>subreddit</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span> \
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>            <span class=o>.</span><span class=n>load</span><span class=p>()</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>        <span class=n>comments_df</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=s2>"jdbc"</span><span class=p>)</span> \
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>            <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>"url"</span><span class=p>,</span> <span class=n>jdbc_url</span><span class=p>)</span> \
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>            <span class=o>.</span><span class=n>option</span><span class=p>(</span><span class=s2>"dbtable"</span><span class=p>,</span> <span class=sa>f</span><span class=s2>"processed_data.comments_</span><span class=si>{</span><span class=n>subreddit</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span> \
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>            <span class=o>.</span><span class=n>load</span><span class=p>()</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>        <span class=c1># Filter for new data since last processing</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>        <span class=k>if</span> <span class=n>last_processed</span><span class=p>:</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>            <span class=n>daily_posts_df</span> <span class=o>=</span> <span class=n>posts_df</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>                <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"created_utc"</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>last_processed</span><span class=p>)</span> <span class=o>&amp;</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>                <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"created_utc"</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>current_timestamp</span><span class=p>)</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>            <span class=n>daily_comments_df</span> <span class=o>=</span> <span class=n>comments_df</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>                <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"created_utc"</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>last_processed</span><span class=p>)</span> <span class=o>&amp;</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a>                <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"created_utc"</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>current_timestamp</span><span class=p>)</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>            <span class=p>)</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>            <span class=n>daily_posts_df</span> <span class=o>=</span> <span class=n>posts_df</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"created_utc"</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>current_timestamp</span><span class=p>)</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>            <span class=n>daily_comments_df</span> <span class=o>=</span> <span class=n>comments_df</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"created_utc"</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>current_timestamp</span><span class=p>)</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a>        <span class=c1># Join posts and comments</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a>        <span class=n>daily_summary_df</span> <span class=o>=</span> <span class=n>daily_posts_df</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"posts"</span><span class=p>)</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a>            <span class=n>daily_comments_df</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"comments"</span><span class=p>),</span> 
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a>            <span class=s2>"post_id"</span><span class=p>,</span> 
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a>            <span class=s2>"right"</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a>        <span class=p>)</span><span class=o>.</span><span class=n>select</span><span class=p>(</span>
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>            <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"subreddit"</span><span class=p>),</span>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a>            <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"posts.post_id"</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"post_id"</span><span class=p>),</span>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a>            <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"posts.score"</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"post_score"</span><span class=p>),</span>
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a>            <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"posts.url"</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"post_url"</span><span class=p>),</span>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a>            <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comments.comment_id"</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"comment_id"</span><span class=p>),</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a>            <span class=n>F</span><span class=o>.</span><span class=n>to_date</span><span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comments.created_utc"</span><span class=p>))</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"summary_date"</span><span class=p>),</span>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a>            <span class=n>F</span><span class=o>.</span><span class=n>current_timestamp</span><span class=p>()</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"processed_date"</span><span class=p>),</span>
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a>            <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"posts.title"</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"post_content"</span><span class=p>),</span>
</span><span id=__span-5-46><a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a>            <span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comments.body"</span><span class=p>)</span><span class=o>.</span><span class=n>alias</span><span class=p>(</span><span class=s2>"comment_body"</span><span class=p>)</span>
</span><span id=__span-5-47><a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a>        <span class=p>)</span>
</span><span id=__span-5-48><a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a>
</span><span id=__span-5-49><a id=__codelineno-5-49 name=__codelineno-5-49 href=#__codelineno-5-49></a>        <span class=c1># Deduplication and quality filtering</span>
</span><span id=__span-5-50><a id=__codelineno-5-50 name=__codelineno-5-50 href=#__codelineno-5-50></a>        <span class=n>daily_summary_df</span> <span class=o>=</span> <span class=n>daily_summary_df</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-5-51><a id=__codelineno-5-51 name=__codelineno-5-51 href=#__codelineno-5-51></a>            <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comment_body"</span><span class=p>)</span><span class=o>.</span><span class=n>isNotNull</span><span class=p>())</span> <span class=o>&amp;</span> 
</span><span id=__span-5-52><a id=__codelineno-5-52 name=__codelineno-5-52 href=#__codelineno-5-52></a>            <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"comment_id"</span><span class=p>)</span><span class=o>.</span><span class=n>isNotNull</span><span class=p>())</span> <span class=o>&amp;</span>
</span><span id=__span-5-53><a id=__codelineno-5-53 name=__codelineno-5-53 href=#__codelineno-5-53></a>            <span class=p>(</span><span class=n>F</span><span class=o>.</span><span class=n>col</span><span class=p>(</span><span class=s2>"post_id"</span><span class=p>)</span><span class=o>.</span><span class=n>isNotNull</span><span class=p>())</span>
</span><span id=__span-5-54><a id=__codelineno-5-54 name=__codelineno-5-54 href=#__codelineno-5-54></a>        <span class=p>)</span>
</span></code></pre></div> To create daily summaries, we load new posts and comments for each subreddit. We then join these datasets on post_id, select the necessary fields, and filter out any rows with null values. This function combines post and comment data, preparing it for further analysis.<p></p> <p>The daily summary data is stored with the following schema:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>processed_data</span><span class=p>.</span><span class=n>daily_summary_data</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=p>,</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=n>subreddit</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=n>post_id</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span><span class=n>post_score</span><span class=w> </span><span class=nb>INTEGER</span><span class=p>,</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>    </span><span class=n>post_url</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>    </span><span class=n>comment_id</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>    </span><span class=n>summary_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>    </span><span class=n>processed_date</span><span class=w> </span><span class=n>TIMESTAMPTZ</span><span class=p>,</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span><span class=n>needs_processing</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>TRUE</span><span class=p>,</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>    </span><span class=n>post_content</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>    </span><span class=n>comment_body</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>post_id</span><span class=p>,</span><span class=w> </span><span class=n>comment_id</span><span class=p>)</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=p>);</span>
</span></code></pre></div> <h4 id=dbt>dbt<a class=headerlink href=#dbt title="Permanent link">¶</a></h4> <h5 id=dbt-data-transformations>DBT Data Transformations<a class=headerlink href=#dbt-data-transformations title="Permanent link">¶</a></h5> <p>Our data transformations are managed using dbt, which allows us to structure our project with specific models for each stage of processing. This approach provides a clear, modular, and maintainable data pipeline.</p> <p></p><div class="language-yaml highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># dbt_project.yml configuration</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>'dbt_reddit_summary_local'</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>'1.0.0'</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=nt>models</span><span class=p>:</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>  </span><span class=nt>dbt_reddit_summary_local</span><span class=p>:</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=nt>+materialized</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">table</span><span class=w>  </span><span class=c1># Default materialization</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>    </span><span class=nt>current_summary_staging</span><span class=p>:</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>      </span><span class=nt>+materialized</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">view</span><span class=w>  </span><span class=c1># Staging view</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>    </span><span class=nt>joined_summary_analysis</span><span class=p>:</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>      </span><span class=nt>+materialized</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">table</span><span class=w>  </span><span class=c1># Final analysis</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>    </span><span class=nt>update_processing_status</span><span class=p>:</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>      </span><span class=nt>+materialized</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">incremental</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=nt>vars</span><span class=p>:</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=w>  </span><span class=nt>subreddits</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>'dataengineering'</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>'datascience'</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>'machinelearning'</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>'claudeai'</span><span class="p p-Indicator">,</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>   </span><span class=s>'singularity'</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>'localllama'</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>'openai'</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>'stablediffusion'</span><span class="p p-Indicator">]</span>
</span></code></pre></div> This dbt project configuration includes a default table materialization, a staging view for intermediate data, a final analysis table, and an incremental model for updating processing status. Additionally, we define a list of subreddits that are processed by our pipeline.<p></p> <p>The DBT workflow includes three main transformation models:</p> <ol> <li> <p><strong>Staging Model</strong> (<code>current_summary_staging</code>): </p><div class="language-sql highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1>-- Materialized as a view for real-time filtering</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=k>SELECT</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>subreddit</span><span class=p>,</span><span class=w> </span><span class=n>post_id</span><span class=p>,</span><span class=w> </span><span class=n>post_score</span><span class=p>,</span><span class=w> </span><span class=n>post_url</span><span class=p>,</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=n>comment_id</span><span class=p>,</span><span class=w> </span><span class=n>summary_date</span><span class=p>,</span><span class=w> </span><span class=n>processed_date</span><span class=p>,</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span><span class=n>post_content</span><span class=p>,</span><span class=w> </span><span class=n>comment_body</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=k>FROM</span><span class=w> </span><span class=err>{{</span><span class=w> </span><span class=k>source</span><span class=p>(</span><span class=s1>'summary_analytics'</span><span class=p>,</span><span class=w> </span><span class=s1>'daily_summary_data'</span><span class=p>)</span><span class=w> </span><span class=err>}}</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=k>WHERE</span><span class=w> </span><span class=n>comment_body</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>needs_processing</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>TRUE</span>
</span></code></pre></div> The current_summary_staging model is a view that selects key fields from the daily summary data, filtering out rows with null comment bodies and those that do not need processing. This view is materialized as a view for real-time filtering.<p></p> </li> <li> <p><strong>Analysis Model</strong> (<code>joined_summary_analysis</code>): </p><div class="language-sql highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=k>WITH</span><span class=w> </span><span class=n>validation_cte</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>        </span><span class=n>cs</span><span class=p>.</span><span class=o>*</span><span class=p>,</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>        </span><span class=n>ts</span><span class=p>.</span><span class=n>comment_summary</span><span class=p>,</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>        </span><span class=n>sa</span><span class=p>.</span><span class=n>sentiment_score</span><span class=p>,</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>        </span><span class=n>sa</span><span class=p>.</span><span class=n>sentiment_label</span><span class=p>,</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>        </span><span class=k>CASE</span><span class=w> </span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>            </span><span class=k>WHEN</span><span class=w> </span><span class=k>LENGTH</span><span class=p>(</span><span class=n>cs</span><span class=p>.</span><span class=n>comment_body</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>'Too short'</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>            </span><span class=k>WHEN</span><span class=w> </span><span class=k>LENGTH</span><span class=p>(</span><span class=n>cs</span><span class=p>.</span><span class=n>comment_body</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10000</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>'Too long'</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>            </span><span class=k>ELSE</span><span class=w> </span><span class=s1>'Valid'</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>        </span><span class=k>END</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>comment_quality</span><span class=p>,</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>        </span><span class=k>CASE</span><span class=w> </span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>            </span><span class=k>WHEN</span><span class=w> </span><span class=n>ts</span><span class=p>.</span><span class=n>comment_summary</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>'Missing'</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>            </span><span class=k>WHEN</span><span class=w> </span><span class=k>LENGTH</span><span class=p>(</span><span class=n>ts</span><span class=p>.</span><span class=n>comment_summary</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=k>LENGTH</span><span class=p>(</span><span class=n>cs</span><span class=p>.</span><span class=n>comment_body</span><span class=p>)</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>'Invalid'</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>            </span><span class=k>ELSE</span><span class=w> </span><span class=s1>'Valid'</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>        </span><span class=k>END</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>summary_quality</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=err>{{</span><span class=w> </span><span class=k>source</span><span class=p>(</span><span class=s1>'summary_analytics'</span><span class=p>,</span><span class=w> </span><span class=s1>'current_summary_staging'</span><span class=p>)</span><span class=w> </span><span class=err>}}</span><span class=w> </span><span class=n>cs</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>    </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=err>{{</span><span class=w> </span><span class=k>source</span><span class=p>(</span><span class=s1>'summary_analytics'</span><span class=p>,</span><span class=w> </span><span class=s1>'text_summary_results'</span><span class=p>)</span><span class=w> </span><span class=err>}}</span><span class=w> </span><span class=n>ts</span><span class=w> </span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>        </span><span class=k>ON</span><span class=w> </span><span class=n>cs</span><span class=p>.</span><span class=n>comment_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ts</span><span class=p>.</span><span class=n>comment_id</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=w>    </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=err>{{</span><span class=w> </span><span class=k>source</span><span class=p>(</span><span class=s1>'summary_analytics'</span><span class=p>,</span><span class=w> </span><span class=s1>'sentiment_analysis_results'</span><span class=p>)</span><span class=w> </span><span class=err>}}</span><span class=w> </span><span class=n>sa</span><span class=w> </span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=w>        </span><span class=k>ON</span><span class=w> </span><span class=n>cs</span><span class=p>.</span><span class=n>comment_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sa</span><span class=p>.</span><span class=n>comment_id</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=p>)</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=k>SELECT</span><span class=w> </span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=w>    </span><span class=o>*</span><span class=p>,</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a><span class=w>    </span><span class=k>CURRENT_TIMESTAMP</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>processed_at</span><span class=p>,</span>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a><span class=w>    </span><span class=s1>'dbt'</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>processed_by</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a><span class=k>FROM</span><span class=w> </span><span class=n>validation_cte</span>
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a><span class=k>WHERE</span><span class=w> </span><span class=n>comment_quality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>'Valid'</span><span class=w> </span>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>summary_quality</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>'Valid'</span>
</span></code></pre></div> The joined_summary_analysis model joins the staging data with text summary and sentiment analysis results. It then validates the quality of comments and summaries, selecting only valid rows for further analysis. This model also adds processing metadata.<p></p> </li> <li> <p><strong>Processing Status Model</strong> (<code>update_processing_status</code>): </p><div class="language-sql highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=err>{{</span><span class=w> </span><span class=n>config</span><span class=p>(</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>    </span><span class=n>materialized</span><span class=o>=</span><span class=s1>'incremental'</span><span class=p>,</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>    </span><span class=n>unique_key</span><span class=o>=</span><span class=p>[</span><span class=s1>'comment_id'</span><span class=p>,</span><span class=w> </span><span class=s1>'post_id'</span><span class=p>],</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=n>post_hook</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>        </span><span class=ss>"""</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=ss>        UPDATE {{ source('summary_analytics', 'daily_summary_data') }}</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=ss>        SET needs_processing = FALSE</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=ss>        WHERE comment_id IN (</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=ss>            SELECT comment_id </span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=ss>            FROM {{ this }}</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=ss>        );</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=ss>        """</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>    </span><span class=p>]</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=p>)</span><span class=w> </span><span class=err>}}</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=c1>-- Select all records that were attempted to be processed, including failed validations</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=k>WITH</span><span class=w> </span><span class=n>validation_cte</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>        </span><span class=n>comment_id</span><span class=p>,</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>        </span><span class=n>comment_body</span><span class=p>,</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>        </span><span class=n>post_id</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=err>{{</span><span class=w> </span><span class=k>source</span><span class=p>(</span><span class=s1>'summary_analytics'</span><span class=p>,</span><span class=w> </span><span class=s1>'current_summary_staging'</span><span class=p>)</span><span class=w> </span><span class=err>}}</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=p>),</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=n>all_processed_records</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>        </span><span class=n>cs</span><span class=p>.</span><span class=n>comment_id</span><span class=p>,</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=w>        </span><span class=n>cs</span><span class=p>.</span><span class=n>post_id</span><span class=p>,</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=w>        </span><span class=n>v</span><span class=p>.</span><span class=n>comment_quality</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=err>{{</span><span class=w> </span><span class=k>source</span><span class=p>(</span><span class=s1>'summary_analytics'</span><span class=p>,</span><span class=w> </span><span class=s1>'current_summary_staging'</span><span class=p>)</span><span class=w> </span><span class=err>}}</span><span class=w> </span><span class=n>cs</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=w>    </span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a><span class=w>        </span><span class=k>SELECT</span><span class=w> </span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=w>            </span><span class=n>comment_id</span><span class=p>,</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=w>            </span><span class=k>CASE</span><span class=w> </span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>                </span><span class=k>WHEN</span><span class=w> </span><span class=k>LENGTH</span><span class=p>(</span><span class=n>comment_body</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>'Too short'</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class=w>                </span><span class=k>WHEN</span><span class=w> </span><span class=k>LENGTH</span><span class=p>(</span><span class=n>comment_body</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10000</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>'Too long'</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a><span class=w>                </span><span class=k>ELSE</span><span class=w> </span><span class=s1>'Valid'</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a><span class=w>            </span><span class=k>END</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>comment_quality</span>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a><span class=w>        </span><span class=k>FROM</span><span class=w> </span><span class=n>validation_cte</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a><span class=w>    </span><span class=p>)</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>cs</span><span class=p>.</span><span class=n>comment_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>comment_id</span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a><span class=p>)</span>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a><span class=k>SELECT</span><span class=w> </span>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a><span class=w>    </span><span class=n>comment_id</span><span class=p>,</span>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a><span class=w>    </span><span class=n>post_id</span>
</span><span id=__span-10-45><a id=__codelineno-10-45 name=__codelineno-10-45 href=#__codelineno-10-45></a><span class=k>FROM</span><span class=w> </span><span class=n>all_processed_records</span>
</span></code></pre></div> The update_processing_status model is an incremental model that updates the processing status of comments. It selects all records that were attempted to be processed, including those that failed validation, and uses a post-hook to mark them as processed in the source table. This ensures that comments are not reprocessed.<p></p> </li> </ol> <h5 id=dbt-data-quality-tests>DBT Data Quality Tests<a class=headerlink href=#dbt-data-quality-tests title="Permanent link">¶</a></h5> <p>Our project implements comprehensive data quality tests using DBT's testing framework. These tests are defined in our <code>schema.yml</code>:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=nt>sources</span><span class=p>:</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">raw_data</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>    </span><span class=nt>schema</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">raw_data</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>    </span><span class=nt>tables</span><span class=p>:</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">raw_dataengineering</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>        </span><span class=nt>columns</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;raw_columns</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">post_id</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>            </span><span class=nt>tests</span><span class=p>:</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">unique</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">is_text</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">subreddit</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>            </span><span class=nt>tests</span><span class=p>:</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">is_text</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>accepted_values</span><span class=p>:</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>                  </span><span class=nt>values</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"dataengineering"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"datascience"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"machinelearning"</span><span class="p p-Indicator">,</span><span class=w> </span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=w>                          </span><span class=s>"claudeai"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"singularity"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"localllama"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"openai"</span><span class="p p-Indicator">,</span><span class=w> </span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=w>                          </span><span class=s>"stablediffusion"</span><span class="p p-Indicator">]</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">score</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=w>            </span><span class=nt>tests</span><span class=p>:</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">is_int</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>dbt_utils.expression_is_true</span><span class=p>:</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=w>                  </span><span class=nt>expression</span><span class=p>:</span><span class=w> </span><span class=s>"{{</span><span class=nv> </span><span class=s>column_name</span><span class=nv> </span><span class=s>}}</span><span class=nv> </span><span class=s>&gt;=</span><span class=nv> </span><span class=s>0"</span>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">comments</span>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=w>            </span><span class=nt>tests</span><span class=p>:</span>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">not_null</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">is_json</span>
</span></code></pre></div> <p>Our testing strategy includes generic tests for data presence and type validation, custom tests for specific data structures and rules, relationship tests for data integrity, and data quality metrics to monitor data health. These tests are integrated into our CI/CD pipeline for early detection of issues.</p> <h4 id=text-processing-pipeline>Text Processing Pipeline<a class=headerlink href=#text-processing-pipeline title="Permanent link">¶</a></h4> <p>Our cleaned data is analyzed using transformer models for text summarization and sentiment analysis, with MLflow for experiment tracking.</p> <h5 id=1-text-summarization>1. Text Summarization<a class=headerlink href=#1-text-summarization title="Permanent link">¶</a></h5> <p>We use a fine-tuned BART model for generating concise summaries of Reddit comments:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=k>def</span><span class=w> </span><span class=nf>create_summarizer</span><span class=p>():</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>    </span><span class=sd>"""Initialize the summarization model."""</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=n>model_name</span> <span class=o>=</span> <span class=s2>"philschmid/bart-large-cnn-samsum"</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=n>local_model_path</span> <span class=o>=</span> <span class=s2>"/models/models--philschmid--bart-large-cnn-samsum/snapshots/e49b3d60d923f12db22bdd363356f1a4c68532ad"</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>    <span class=n>tokenizer</span> <span class=o>=</span> <span class=n>AutoTokenizer</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=n>local_model_path</span><span class=p>)</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>    <span class=n>model</span> <span class=o>=</span> <span class=n>AutoModelForSeq2SeqLM</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>        <span class=n>local_model_path</span><span class=p>,</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>        <span class=n>torch_dtype</span><span class=o>=</span><span class=n>torch</span><span class=o>.</span><span class=n>float32</span><span class=p>,</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>        <span class=n>device_map</span><span class=o>=</span><span class=s2>"auto"</span><span class=p>,</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>        <span class=n>low_cpu_mem_usage</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>    <span class=p>)</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>    <span class=k>return</span> <span class=n>pipeline</span><span class=p>(</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>        <span class=s2>"summarization"</span><span class=p>,</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>        <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a>        <span class=n>tokenizer</span><span class=o>=</span><span class=n>tokenizer</span><span class=p>,</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>        <span class=n>framework</span><span class=o>=</span><span class=s2>"pt"</span>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>    <span class=p>)</span>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=k>def</span><span class=w> </span><span class=nf>generate_summary</span><span class=p>(</span><span class=n>comment_body</span><span class=p>,</span> <span class=n>summarizer</span><span class=p>):</span>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=w>    </span><span class=sd>"""Generate summary for a given comment."""</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>comment_body</span><span class=o>.</span><span class=n>split</span><span class=p>())</span> <span class=o>&lt;=</span> <span class=mi>59</span><span class=p>:</span>
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a>        <span class=k>return</span> <span class=n>comment_body</span> 
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>        <span class=n>summary</span> <span class=o>=</span> <span class=n>summarizer</span><span class=p>(</span>
</span><span id=__span-12-28><a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a>            <span class=n>comment_body</span><span class=p>,</span> 
</span><span id=__span-12-29><a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a>            <span class=n>max_length</span><span class=o>=</span><span class=mi>60</span><span class=p>,</span> 
</span><span id=__span-12-30><a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a>            <span class=n>min_length</span><span class=o>=</span><span class=mi>15</span><span class=p>,</span> 
</span><span id=__span-12-31><a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a>            <span class=n>do_sample</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> 
</span><span id=__span-12-32><a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a>            <span class=n>truncation</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-12-33><a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a>        <span class=p>)</span>
</span><span id=__span-12-34><a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a>        <span class=k>if</span> <span class=n>summary</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>summary</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>summary</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-12-35><a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a>            <span class=k>return</span> <span class=n>summary</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>'summary_text'</span><span class=p>]</span>
</span><span id=__span-12-36><a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-12-37><a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a>        <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Summarization failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-12-38><a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a>
</span><span id=__span-12-39><a id=__codelineno-12-39 name=__codelineno-12-39 href=#__codelineno-12-39></a>    <span class=k>return</span> <span class=s2>""</span>
</span></code></pre></div> <p>We use a fine-tuned BART-large model for dialogue summarization, which outperforms the standard model on Reddit comments. It's optimized for local machine use with efficient memory management.</p> <h5 id=2-sentiment-analysis>2. Sentiment Analysis<a class=headerlink href=#2-sentiment-analysis title="Permanent link">¶</a></h5> <p>We employ a RoBERTa-based model fine-tuned for emotion detection:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=k>def</span><span class=w> </span><span class=nf>initialize_emotion_analyzer</span><span class=p>():</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=w>    </span><span class=sd>"""Initialize the emotion analysis model."""</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>    <span class=n>model_name</span> <span class=o>=</span> <span class=s2>"SamLowe/roberta-base-go_emotions"</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>    <span class=n>local_model_path</span> <span class=o>=</span> <span class=s2>"/models/models--SamLowe--roberta-base-go_emotions/snapshots/58b6c5b44a7a12093f782442969019c7e2982299"</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>    <span class=n>model</span> <span class=o>=</span> <span class=n>AutoModelForSequenceClassification</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=n>local_model_path</span><span class=p>)</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>    <span class=n>tokenizer</span> <span class=o>=</span> <span class=n>AutoTokenizer</span><span class=o>.</span><span class=n>from_pretrained</span><span class=p>(</span><span class=n>local_model_path</span><span class=p>)</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>    <span class=k>return</span> <span class=n>pipeline</span><span class=p>(</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>        <span class=s2>"text-classification"</span><span class=p>,</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>        <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>        <span class=n>tokenizer</span><span class=o>=</span><span class=n>tokenizer</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a>    <span class=p>)</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=k>def</span><span class=w> </span><span class=nf>perform_sentiment_analysis</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>emotion_analyzer</span><span class=p>):</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>    </span><span class=sd>"""Perform sentiment analysis on the given text."""</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>text</span> <span class=ow>or</span> <span class=n>text</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=o>==</span> <span class=s2>""</span><span class=p>:</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>            <span class=k>return</span> <span class=s2>"Neutral"</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=s2>"No content"</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a>        <span class=n>truncated_text</span> <span class=o>=</span> <span class=n>truncate_text</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>max_length</span><span class=o>=</span><span class=mi>500</span><span class=p>)</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a>        <span class=n>emotion_output</span> <span class=o>=</span> <span class=n>emotion_analyzer</span><span class=p>(</span><span class=n>truncated_text</span><span class=p>)</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>emotion_output</span><span class=p>:</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a>            <span class=k>return</span> <span class=s2>"Neutral"</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=s2>"Analysis failed"</span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a>        <span class=n>emotion_label</span> <span class=o>=</span> <span class=n>emotion_output</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>'label'</span><span class=p>]</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a>        <span class=n>emotion_score</span> <span class=o>=</span> <span class=n>emotion_output</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>'score'</span><span class=p>]</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a>        <span class=c1># Map emotions to sentiment categories</span>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a>        <span class=n>sentiment_mapping</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a>            <span class=s1>'joy'</span><span class=p>:</span> <span class=s1>'Positive'</span><span class=p>,</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a>            <span class=s1>'love'</span><span class=p>:</span> <span class=s1>'Positive'</span><span class=p>,</span>
</span><span id=__span-13-34><a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a>            <span class=s1>'admiration'</span><span class=p>:</span> <span class=s1>'Positive'</span><span class=p>,</span>
</span><span id=__span-13-35><a id=__codelineno-13-35 name=__codelineno-13-35 href=#__codelineno-13-35></a>            <span class=s1>'approval'</span><span class=p>:</span> <span class=s1>'Positive'</span><span class=p>,</span>
</span><span id=__span-13-36><a id=__codelineno-13-36 name=__codelineno-13-36 href=#__codelineno-13-36></a>            <span class=s1>'excitement'</span><span class=p>:</span> <span class=s1>'Positive'</span><span class=p>,</span>
</span><span id=__span-13-37><a id=__codelineno-13-37 name=__codelineno-13-37 href=#__codelineno-13-37></a>            <span class=s1>'gratitude'</span><span class=p>:</span> <span class=s1>'Positive'</span><span class=p>,</span>
</span><span id=__span-13-38><a id=__codelineno-13-38 name=__codelineno-13-38 href=#__codelineno-13-38></a>            <span class=s1>'optimism'</span><span class=p>:</span> <span class=s1>'Positive'</span><span class=p>,</span>
</span><span id=__span-13-39><a id=__codelineno-13-39 name=__codelineno-13-39 href=#__codelineno-13-39></a>            <span class=s1>'anger'</span><span class=p>:</span> <span class=s1>'Negative'</span><span class=p>,</span>
</span><span id=__span-13-40><a id=__codelineno-13-40 name=__codelineno-13-40 href=#__codelineno-13-40></a>            <span class=s1>'disappointment'</span><span class=p>:</span> <span class=s1>'Negative'</span><span class=p>,</span>
</span><span id=__span-13-41><a id=__codelineno-13-41 name=__codelineno-13-41 href=#__codelineno-13-41></a>            <span class=s1>'disgust'</span><span class=p>:</span> <span class=s1>'Negative'</span><span class=p>,</span>
</span><span id=__span-13-42><a id=__codelineno-13-42 name=__codelineno-13-42 href=#__codelineno-13-42></a>            <span class=s1>'fear'</span><span class=p>:</span> <span class=s1>'Negative'</span><span class=p>,</span>
</span><span id=__span-13-43><a id=__codelineno-13-43 name=__codelineno-13-43 href=#__codelineno-13-43></a>            <span class=s1>'sadness'</span><span class=p>:</span> <span class=s1>'Negative'</span><span class=p>,</span>
</span><span id=__span-13-44><a id=__codelineno-13-44 name=__codelineno-13-44 href=#__codelineno-13-44></a>            <span class=s1>'confusion'</span><span class=p>:</span> <span class=s1>'Neutral'</span><span class=p>,</span>
</span><span id=__span-13-45><a id=__codelineno-13-45 name=__codelineno-13-45 href=#__codelineno-13-45></a>            <span class=s1>'curiosity'</span><span class=p>:</span> <span class=s1>'Neutral'</span><span class=p>,</span>
</span><span id=__span-13-46><a id=__codelineno-13-46 name=__codelineno-13-46 href=#__codelineno-13-46></a>            <span class=s1>'surprise'</span><span class=p>:</span> <span class=s1>'Neutral'</span>
</span><span id=__span-13-47><a id=__codelineno-13-47 name=__codelineno-13-47 href=#__codelineno-13-47></a>        <span class=p>}</span>
</span><span id=__span-13-48><a id=__codelineno-13-48 name=__codelineno-13-48 href=#__codelineno-13-48></a>
</span><span id=__span-13-49><a id=__codelineno-13-49 name=__codelineno-13-49 href=#__codelineno-13-49></a>        <span class=n>sentiment_label</span> <span class=o>=</span> <span class=n>sentiment_mapping</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>emotion_label</span><span class=o>.</span><span class=n>lower</span><span class=p>(),</span> <span class=s1>'Neutral'</span><span class=p>)</span>
</span><span id=__span-13-50><a id=__codelineno-13-50 name=__codelineno-13-50 href=#__codelineno-13-50></a>        <span class=k>return</span> <span class=n>sentiment_label</span><span class=p>,</span> <span class=nb>float</span><span class=p>(</span><span class=n>emotion_score</span><span class=p>),</span> <span class=n>emotion_label</span>
</span><span id=__span-13-51><a id=__codelineno-13-51 name=__codelineno-13-51 href=#__codelineno-13-51></a>
</span><span id=__span-13-52><a id=__codelineno-13-52 name=__codelineno-13-52 href=#__codelineno-13-52></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-13-53><a id=__codelineno-13-53 name=__codelineno-13-53 href=#__codelineno-13-53></a>        <span class=n>logging</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Error during sentiment analysis: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-13-54><a id=__codelineno-13-54 name=__codelineno-13-54 href=#__codelineno-13-54></a>        <span class=k>return</span> <span class=s2>"Neutral"</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=s2>"Error in analysis"</span>
</span></code></pre></div> <p>Our sentiment analysis component uses a RoBERTa model fine-tuned for emotion detection, which we found to be more effective than standard sentiment analysis for Reddit comments. Key features include smart text truncation, mapping to sentiment categories (Positive, Negative, or Neutral), and comprehensive error handling.</p> <h5 id=3-pipeline-integration>3. Pipeline Integration<a class=headerlink href=#3-pipeline-integration title="Permanent link">¶</a></h5> <p>Both components are integrated into the data pipeline with MLflow, which we use for experiment tracking, allowing us to monitor model performance and manage different model versions. We also use MLflow for model serving, enabling us to deploy our models.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># MLflow configuration</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=n>mlflow</span><span class=o>.</span><span class=n>set_tracking_uri</span><span class=p>(</span><span class=s2>"http://mlflow:5000"</span><span class=p>)</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=n>mlflow</span><span class=o>.</span><span class=n>set_experiment</span><span class=p>(</span><span class=s2>"reddit_sentiment_analysis_experiments"</span><span class=p>)</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=k>with</span> <span class=n>mlflow</span><span class=o>.</span><span class=n>start_run</span><span class=p>()</span> <span class=k>as</span> <span class=n>run</span><span class=p>:</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=c1># Log parameters</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>    <span class=n>mlflow</span><span class=o>.</span><span class=n>log_param</span><span class=p>(</span><span class=s2>"model_name"</span><span class=p>,</span> <span class=s2>"SamLowe/roberta-base-go_emotions"</span><span class=p>)</span>
</span></code></pre></div> <h4 id=gemini-ai-analysis>Gemini AI Analysis<a class=headerlink href=#gemini-ai-analysis title="Permanent link">¶</a></h4> <p>We use Google's Gemini AI for advanced analysis, generating structured insights from Reddit discussions with a focus on content safety and consistent formatting.</p> <h5 id=1-analysis-configuration>1. Analysis Configuration<a class=headerlink href=#1-analysis-configuration title="Permanent link">¶</a></h5> <p>The Gemini analysis is guided by a prompt template that instructs the model to filter content for safety, rank threads by score, summarize content, analyze emotions, extract top viewpoints, and embed links. The output is structured with a title, date, description, tags, overall ranking, and detailed thread analysis.</p> <p></p><div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=k>def</span><span class=w> </span><span class=nf>create_prompt_template</span><span class=p>():</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>    </span><span class=sd>"""Return the standard prompt template for Gemini analysis."""</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>'%Y-%m-</span><span class=si>%d</span><span class=s1>'</span><span class=p>)</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>    <span class=k>return</span> <span class=sa>f</span><span class=s2>"""</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=s2>    Analyze the provided text files, which contain Reddit posts and comments.</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=s2>    **Instructions:**</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=s2>    1.  **Content Filtering:** Check for harassment, hate speech, or explicit material</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=s2>    2.  **Ranking:** Rank threads by total "Score"</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=s2>    3.  **Summarization:** Utilize "Summary" fields for thread overviews</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=s2>    4.  **Emotional Analysis:** Analyze "Emotion Label" and "Emotion Score"</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=s2>    5.  **Point of View Extraction:** Extract top 3 viewpoints per thread</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=s2>    6.  **Links:** Embed URLs in thread titles using Markdown</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=s2>    **Output Format:**</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=s2>    ---</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=s2>    title: "</span><span class=se>{{</span><span class=s2>subreddit_name</span><span class=se>}}</span><span class=s2> subreddit"</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=s2>    date: "</span><span class=si>{</span><span class=n>current_date</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=s2>    description: "Analysis of top discussions and trends"</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=s2>    tags: ["tag1", "tag2", "tag3"]</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=s2>    ---</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=s2>    # Overall Ranking and Top Discussions</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=s2>    [Ranked list of threads with scores and summaries]</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=s2>    # Detailed Analysis by Thread </span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=s2>    [Thread-by-thread analysis with summaries, emotions, and viewpoints]</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=s2>    """</span>
</span></code></pre></div> The Gemini analysis is guided by a prompt template that instructs the model to filter content for safety, rank threads by score, summarize content, analyze emotions, extract top viewpoints, and embed links. The output is structured with a title, date, description, tags, overall ranking, and detailed thread analysis.<p></p> <h5 id=2-data-processing>2. Data Processing<a class=headerlink href=#2-data-processing title="Permanent link">¶</a></h5> <p>The system processes data subreddit by subreddit, formatting each post and its comments:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>def</span><span class=w> </span><span class=nf>process_subreddit</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>cur</span><span class=p>,</span> <span class=n>subreddit</span><span class=p>,</span> <span class=n>output_dir</span><span class=p>):</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=w>    </span><span class=sd>"""Process a single subreddit's data."""</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=c1># Fetch processed data</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=n>cur</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"""</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=s2>        SELECT post_id, subreddit, post_score, post_url, comment_id,</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=s2>               summary_date, post_content, comment_body, comment_summary,</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=s2>               sentiment_score, sentiment_label</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=s2>        FROM processed_data.joined_summary_analysis</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=s2>        WHERE subreddit = </span><span class=si>%s</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=s2>        ORDER BY post_score DESC</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=s2>    """</span><span class=p>,</span> <span class=p>(</span><span class=n>subreddit</span><span class=p>,))</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>    <span class=c1># Format data for analysis</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a>    <span class=n>text_files</span> <span class=o>=</span> <span class=s2>""</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a>        <span class=n>format_text_file</span><span class=p>(</span><span class=n>row</span><span class=p>)</span> <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>cur</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a>    <span class=p>)</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a>    <span class=c1># Generate insights using Gemini</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>generate_content</span><span class=p>(</span><span class=n>final_prompt</span> <span class=o>+</span> <span class=n>text_files</span><span class=p>)</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a>    <span class=c1># Save formatted output</span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>    <span class=n>output_file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>output_dir</span><span class=p>,</span> <span class=sa>f</span><span class=s2>"llm_</span><span class=si>{</span><span class=n>subreddit</span><span class=si>}</span><span class=s2>.md"</span><span class=p>)</span>
</span><span id=__span-16-23><a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>output_file_path</span><span class=p>,</span> <span class=s2>"w"</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>"utf-8"</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-16-24><a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></code></pre></div> <h5 id=3-output-formatting>3. Output Formatting<a class=headerlink href=#3-output-formatting title="Permanent link">¶</a></h5> <p>The system ensures consistent formatting across all analyses:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=k>def</span><span class=w> </span><span class=nf>get_formatted_subreddit_name</span><span class=p>(</span><span class=n>subreddit</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=w>    </span><span class=sd>"""Returns a properly formatted subreddit name for display."""</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>    <span class=n>subreddit_formats</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>        <span class=s2>"claudeai"</span><span class=p>:</span> <span class=s2>"ClaudeAI"</span><span class=p>,</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>        <span class=s2>"dataengineering"</span><span class=p>:</span> <span class=s2>"Data Engineering"</span><span class=p>,</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>        <span class=s2>"datascience"</span><span class=p>:</span> <span class=s2>"Data Science"</span><span class=p>,</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>        <span class=s2>"localllama"</span><span class=p>:</span> <span class=s2>"LocalLLaMA"</span><span class=p>,</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>        <span class=s2>"machinelearning"</span><span class=p>:</span> <span class=s2>"Machine Learning"</span><span class=p>,</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>        <span class=s2>"openai"</span><span class=p>:</span> <span class=s2>"OpenAI"</span><span class=p>,</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>        <span class=s2>"singularity"</span><span class=p>:</span> <span class=s2>"Singularity"</span><span class=p>,</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>        <span class=s2>"stablediffusion"</span><span class=p>:</span> <span class=s2>"Stable Diffusion"</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>    <span class=p>}</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a>    <span class=k>return</span> <span class=sa>f</span><span class=s2>"</span><span class=si>{</span><span class=n>subreddit_formats</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>subreddit</span><span class=o>.</span><span class=n>lower</span><span class=p>(),</span><span class=w> </span><span class=n>subreddit</span><span class=p>)</span><span class=si>}</span><span class=s2> Subreddit"</span>
</span></code></pre></div> <h5 id=4-pipeline-integration>4. Pipeline Integration<a class=headerlink href=#4-pipeline-integration title="Permanent link">¶</a></h5> <p>The analysis is integrated into the main pipeline with organized output storage:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=k>def</span><span class=w> </span><span class=nf>analyze_data</span><span class=p>():</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=w>    </span><span class=sd>"""Main function to analyze Reddit data using Gemini."""</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>    <span class=c1># Set up dated output directory</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>    <span class=n>current_date</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>    <span class=n>output_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>        <span class=s1>'/opt/airflow/results'</span><span class=p>,</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>        <span class=n>current_date</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>'%Y'</span><span class=p>),</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>        <span class=n>current_date</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>'%m'</span><span class=p>),</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>        <span class=n>current_date</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>'</span><span class=si>%d</span><span class=s1>'</span><span class=p>)</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>    <span class=p>)</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>output_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a>    <span class=c1># Initialize Gemini model</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>    <span class=n>model</span> <span class=o>=</span> <span class=n>genai</span><span class=o>.</span><span class=n>GenerativeModel</span><span class=p>(</span><span class=s1>'gemini-2.0-flash-exp'</span><span class=p>)</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a>    <span class=c1># Process each subreddit</span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a>    <span class=k>for</span> <span class=n>subreddit</span> <span class=ow>in</span> <span class=n>SUBREDDITS</span><span class=p>:</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a>        <span class=n>process_subreddit</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>cur</span><span class=p>,</span> <span class=n>subreddit</span><span class=p>,</span> <span class=n>output_dir</span><span class=p>)</span>
</span></code></pre></div> <h4 id=web-application>Web Application<a class=headerlink href=#web-application title="Permanent link">¶</a></h4> <p>Our web application, built with Next.js 15, React 18, TypeScript, and MDX, provides a modern and user-friendly way to explore our insights. The application automatically syncs with our on-premise analysis results and deploys to Vercel using GitHub Actions, with build optimizations for performance.</p> <h5 id=automated-deployment>Automated Deployment<a class=headerlink href=#automated-deployment title="Permanent link">¶</a></h5> <p>The deployment process leverages GitHub Actions:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># .github/workflows/deploy.yml</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to Vercel</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=nt>on</span><span class=p>:</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>  </span><span class=nt>push</span><span class=p>:</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>  </span><span class=nt>VERCEL_ORG_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.VERCEL_ORG_ID }}</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>  </span><span class=nt>VERCEL_PROJECT_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.VERCEL_PROJECT_ID }}</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Setup Node.js</span>
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-node@v4</span>
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-19-24><a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a><span class=w>          </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class=s>'20'</span>
</span><span id=__span-19-25><a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a><span class=w>          </span><span class=nt>cache</span><span class=p>:</span><span class=w> </span><span class=s>'npm'</span>
</span><span id=__span-19-26><a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
</span><span id=__span-19-27><a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm ci</span>
</span><span id=__span-19-28><a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Install Vercel CLI</span>
</span><span id=__span-19-29><a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm install --global vercel@latest</span>
</span><span id=__span-19-30><a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Pull Vercel Environment Information</span>
</span><span id=__span-19-31><a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}</span>
</span><span id=__span-19-32><a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build Project Artifacts</span>
</span><span id=__span-19-33><a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}</span>
</span><span id=__span-19-34><a id=__codelineno-19-34 name=__codelineno-19-34 href=#__codelineno-19-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deploy Project Artifacts to Vercel</span>
</span><span id=__span-19-35><a id=__codelineno-19-35 name=__codelineno-19-35 href=#__codelineno-19-35></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}</span>
</span></code></pre></div> <h4 id=orchestrator-stack>Orchestrator Stack<a class=headerlink href=#orchestrator-stack title="Permanent link">¶</a></h4> <p>Our pipeline is orchestrated using Apache Airflow, configured with a robust setup that ensures reliability, scalability, and observability. The orchestration layer manages the entire data pipeline from ingestion to analysis.</p> <h5 id=1-airflow-configuration>1. Airflow Configuration<a class=headerlink href=#1-airflow-configuration title="Permanent link">¶</a></h5> <p>The Airflow setup is containerized using Docker Compose with several key components:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=nt>x-common-env</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;common-env</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=w>  </span><span class=nt>AIRFLOW__CORE__EXECUTOR</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CeleryExecutor</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>  </span><span class=nt>AIRFLOW__DATABASE__SQL_ALCHEMY_CONN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql+psycopg2://airflow:airflow@postgres/airflow</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>  </span><span class=nt>AIRFLOW__CELERY__RESULT_BACKEND</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db+postgresql://airflow:airflow@postgres/airflow</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>  </span><span class=nt>AIRFLOW__CELERY__BROKER_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis://:@redis:6379/0</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>  </span><span class=nt>AIRFLOW__METRICS__STATSD_ON</span><span class=p>:</span><span class=w> </span><span class=s>"true"</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>  </span><span class=nt>AIRFLOW__METRICS__STATSD_HOST</span><span class=p>:</span><span class=w> </span><span class=s>"statsd-exporter"</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>  </span><span class=nt>AIRFLOW__METRICS__STATSD_PORT</span><span class=p>:</span><span class=w> </span><span class=s>"9125"</span>
</span></code></pre></div> <p>The Airflow services are deployed as separate containers, each with specific responsibilities:</p> <ol> <li> <p><strong>Airflow Webserver</strong> </p><div class="language-yaml highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=nt>airflow-webserver</span><span class=p>:</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w>  </span><span class=nt>build</span><span class=p>:</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>    </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>    </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile.webserver</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"8080:8080"</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w> </span><span class=nv>*common-volumes</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-env</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=w>  </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">airflow webserver</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"CMD"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"curl"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"--fail"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>"http://localhost:8080/health"</span><span class="p p-Indicator">]</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span></code></pre></div> Our Airflow webserver provides the web UI for DAG management and monitoring, handles user authentication and authorization, exposes REST API endpoints, and includes health checks to ensure UI availability.<p></p> </li> <li> <p><strong>Airflow Scheduler</strong> </p><div class="language-yaml highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=nt>airflow-scheduler</span><span class=p>:</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>  </span><span class=nt>build</span><span class=p>:</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=w>    </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=w>    </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile.scheduler</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w> </span><span class=nv>*common-volumes</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-env</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>  </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">airflow scheduler</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"CMD-SHELL"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>'airflow</span><span class=nv> </span><span class=s>jobs</span><span class=nv> </span><span class=s>check</span><span class=nv> </span><span class=s>--job-type</span><span class=nv> </span><span class=s>SchedulerJob</span><span class=nv> </span><span class=s>--hostname</span><span class=nv> </span><span class=s>"$${HOSTNAME}"'</span><span class="p p-Indicator">]</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span></code></pre></div> The Airflow scheduler monitors and triggers task execution, manages DAG parsing and scheduling, handles task dependencies and queuing, and ensures proper task distribution to workers. This component is crucial for orchestrating our data pipeline.<p></p> </li> <li> <p><strong>Airflow Worker</strong> </p><div class="language-yaml highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=nt>airflow-worker</span><span class=p>:</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=w>  </span><span class=nt>build</span><span class=p>:</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>    </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>    </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile.worker</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w> </span><span class=nv>*common-volumes</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-env</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>    </span><span class=nt>TRANSFORMERS_OFFLINE</span><span class=p>:</span><span class=w> </span><span class=s>"0"</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>    </span><span class=nt>TOKENIZERS_PARALLELISM</span><span class=p>:</span><span class=w> </span><span class=s>"false"</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>    </span><span class=nt>PYTORCH_ENABLE_MPS_FALLBACK</span><span class=p>:</span><span class=w> </span><span class=s>"1"</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>  </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">airflow celery worker</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>"CMD-SHELL"</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>'celery</span><span class=nv> </span><span class=s>inspect</span><span class=nv> </span><span class=s>ping</span><span class=nv> </span><span class=s>-d</span><span class=nv> </span><span class=s>"celery@$${HOSTNAME}"'</span><span class="p p-Indicator">]</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span></code></pre></div> Our Airflow worker executes the actual tasks, handles ML model inference, manages resource allocation, supports parallel task execution, and is configured for ML workloads with PyTorch and Transformers.<p></p> </li> <li> <p><strong>Airflow Init</strong> </p><div class="language-yaml highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=nt>airflow-init</span><span class=p>:</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=w>  </span><span class=nt>build</span><span class=p>:</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>    </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile.webserver</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>  </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>    </span><span class=no>bash -c "</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>    </span><span class=no>airflow db init &amp;&amp;</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>    </span><span class=no>airflow db upgrade &amp;&amp;</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>    </span><span class=no>airflow users create -r Admin -u admin -p admin -e admin@example.com -f Anonymous -l Admin</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>    </span><span class=no>"</span>
</span></code></pre></div> The Airflow init service initializes the Airflow database, creates an admin user, performs database migrations, and runs only during the initial setup. This component is essential for setting up the Airflow environment.<p></p> </li> </ol> <h5 id=2-pipeline-structure>2. Pipeline Structure<a class=headerlink href=#2-pipeline-structure title="Permanent link">¶</a></h5> <p>Our DAG (<code>reddit_pipeline</code>) is organized into 26 stages but can be categorized into 5 main sections, each with specific responsibilities and metrics collection:</p> <ol> <li><strong>Data Collection and Preprocessing</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=n>ingest_task</span> <span class=o>=</span> <span class=n>PythonOperator</span><span class=p>(</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>    <span class=n>task_id</span><span class=o>=</span><span class=s1>'ingest_and_preprocess'</span><span class=p>,</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>    <span class=n>python_callable</span><span class=o>=</span><span class=n>ingest_preprocess_process</span><span class=p>,</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>    <span class=n>provide_context</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=p>)</span>
</span></code></pre></div> Data is ingested and preprocessed.</li> <li><strong>DBT Transformations</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=n>dbt_staging_task</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>    <span class=n>task_id</span><span class=o>=</span><span class=s1>'run_dbt_staging'</span><span class=p>,</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>    <span class=n>bash_command</span><span class=o>=</span><span class=s1>'cd /opt/airflow/dags/dbt_reddit_summary_local &amp;&amp; dbt run --select current_summary_staging'</span><span class=p>,</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>    <span class=n>dag</span><span class=o>=</span><span class=n>dag</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=p>)</span>
</span></code></pre></div> DBT transformations are run to prepare the data for analysis.</li> <li> <p><strong>Model Processing</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>    <span class=n>summarize_metrics_task</span> <span class=o>=</span> <span class=n>PythonOperator</span><span class=p>(</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>'parse_summarize_metrics'</span><span class=p>,</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>        <span class=n>python_callable</span><span class=o>=</span><span class=n>parse_summarize_metrics</span><span class=p>,</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>        <span class=n>provide_context</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>    <span class=p>)</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>    <span class=n>sentiment_task</span> <span class=o>=</span> <span class=n>PythonOperator</span><span class=p>(</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>'run_sentiment_analysis'</span><span class=p>,</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>        <span class=n>python_callable</span><span class=o>=</span><span class=n>sentiment_analysis_process</span><span class=p>,</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>        <span class=n>provide_context</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>    <span class=p>)</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>    <span class=n>gemini_task</span> <span class=o>=</span> <span class=n>PythonOperator</span><span class=p>(</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>'run_gemini'</span><span class=p>,</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a>        <span class=n>python_callable</span><span class=o>=</span><span class=n>gemini_analysis_process</span><span class=p>,</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>        <span class=n>dag</span><span class=o>=</span><span class=n>dag</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a>    <span class=p>)</span>
</span></code></pre></div> Our analysis pipeline includes text summarization using BART, sentiment analysis with RoBERTa, and advanced analysis with Gemini AI.<p></p> </li> <li> <p><strong>Quality Checks</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=n>dbt_test_raw_sources</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>    <span class=n>task_id</span><span class=o>=</span><span class=s1>'test_raw_sources'</span><span class=p>,</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>    <span class=n>bash_command</span><span class=o>=</span><span class=n>DBT_TEST_CMD</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>selector</span><span class=o>=</span><span class=s1>'source:raw_data source:processed_data'</span><span class=p>),</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>    <span class=n>dag</span><span class=o>=</span><span class=n>dag</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=p>)</span>
</span></code></pre></div> DBT tests are run to ensure the data is valid.<p></p> </li> <li><strong>Metrics Collection</strong><ul> <li>We monitor our pipeline with dedicated metrics tasks, using a StatsD exporter to send real-time data to Prometheus, and MLflow tracking for model performance.</li> </ul> </li> </ol> <h5 id=3-task-dependencies>3. Task Dependencies<a class=headerlink href=#3-task-dependencies title="Permanent link">¶</a></h5> <p>The pipeline follows a clear dependency chain: </p><div class="language-python highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=n>ingest_task</span> <span class=o>&gt;&gt;</span> <span class=n>ingest_metrics_task</span> <span class=o>&gt;&gt;</span> \
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=n>dbt_test_raw_sources</span> <span class=o>&gt;&gt;</span> <span class=n>dbt_test_raw_metrics_task</span> <span class=o>&gt;&gt;</span> \
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=n>dbt_staging_task</span> <span class=o>&gt;&gt;</span> <span class=n>dbt_test_staging_models</span> <span class=o>&gt;&gt;</span> \
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=n>summarize_task</span> <span class=o>&gt;&gt;</span> <span class=n>sentiment_task</span> <span class=o>&gt;&gt;</span> \
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=n>dbt_join_summary_analysis_task</span> <span class=o>&gt;&gt;</span> \
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=n>gemini_task</span> <span class=o>&gt;&gt;</span> <span class=n>push_gemini_results_task</span>
</span></code></pre></div> Our pipeline starts with data ingestion and preprocessing, followed by DBT testing and staging, then text summarization and sentiment analysis, and finally Gemini AI analysis and result pushing.<p></p> <h5 id=4-integration-points>4. Integration Points<a class=headerlink href=#4-integration-points title="Permanent link">¶</a></h5> <p>The orchestrator connects with PostgreSQL for pipeline data storage, local model deployment for model serving, StatsD and Prometheus for monitoring, and GitHub for version control of results. These connections are essential for the functionality of our pipeline</p> <h4 id=observability-stack>Observability Stack<a class=headerlink href=#observability-stack title="Permanent link">¶</a></h4> <p>We use Grafana, Prometheus, and MLflow for comprehensive pipeline observability, with each component containerized and integrated through a centralized metrics system.</p> <h5 id=1-metrics-collection-architecture>1. Metrics Collection Architecture<a class=headerlink href=#1-metrics-collection-architecture title="Permanent link">¶</a></h5> <p>The metrics collection is structured in layers:</p> <ol> <li> <p><strong>Source Metrics</strong> (via StatsD) </p><div class="language-yaml highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=nt>AIRFLOW__METRICS__STATSD_ON</span><span class=p>:</span><span class=w> </span><span class=s>"true"</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=nt>AIRFLOW__METRICS__STATSD_HOST</span><span class=p>:</span><span class=w> </span><span class=s>"statsd-exporter"</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=nt>AIRFLOW__METRICS__STATSD_PORT</span><span class=p>:</span><span class=w> </span><span class=s>"9125"</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=nt>AIRFLOW__METRICS__STATSD_PREFIX</span><span class=p>:</span><span class=w> </span><span class=s>"airflow"</span>
</span></code></pre></div><p></p> </li> <li> <p><strong>Prometheus Targets</strong> </p><div class="language-yaml highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=nt>scrape_configs</span><span class=p>:</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>'airflow'</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=w>    </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>'statsd-exporter:9102'</span><span class="p p-Indicator">]</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>'redis'</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>    </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>'redis-exporter:9121'</span><span class="p p-Indicator">]</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>'postgres'</span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=w>    </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>'postgres-exporter:9187'</span><span class="p p-Indicator">]</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>'mlflow'</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=w>    </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>'mlflow:5000'</span><span class="p p-Indicator">]</span>
</span></code></pre></div><p></p> </li> </ol> <h5 id=2-task-specific-metrics>2. Task-Specific Metrics<a class=headerlink href=#2-task-specific-metrics title="Permanent link">¶</a></h5> <p>Each pipeline component has dedicated metrics tracking:</p> <ol> <li> <p><strong>Gemini Analysis Metrics</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1># From log_gemini_metrics.py</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>    <span class=s1>'outputs_generated'</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>      <span class=c1># Number of successful analyses</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>    <span class=s1>'subreddits_processed'</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>   <span class=c1># Subreddits completed</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>    <span class=s1>'duration_seconds'</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>       <span class=c1># Processing time</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>    <span class=s1>'attempt'</span><span class=p>:</span> <span class=n>current_attempt</span>   <span class=c1># Retry tracking</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=p>}</span>
</span></code></pre></div><p></p> </li> <li> <p><strong>Sentiment Analysis Performance</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1># From log_sentiment_analysis_metrics.py</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>    <span class=s1>'sentiments_processed'</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>   <span class=c1># Comments analyzed</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>    <span class=s1>'duration_seconds'</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>       <span class=c1># Processing duration</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>    <span class=s1>'attempt'</span><span class=p>:</span> <span class=n>current_attempt</span>   <span class=c1># Execution attempts</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=p>}</span>
</span></code></pre></div><p></p> </li> <li> <p><strong>Pipeline Processing Volumes</strong> </p><div class="language-json highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=p>{</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=w>  </span><span class=nt>"targets"</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=w>    </span><span class=p>{</span><span class=nt>"expr"</span><span class=p>:</span><span class=w> </span><span class=s2>"reddit_ingest_preprocess_posts_total"</span><span class=p>},</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=w>    </span><span class=p>{</span><span class=nt>"expr"</span><span class=p>:</span><span class=w> </span><span class=s2>"reddit_summarize_summaries_added"</span><span class=p>},</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=w>    </span><span class=p>{</span><span class=nt>"expr"</span><span class=p>:</span><span class=w> </span><span class=s2>"reddit_sentiment_processed_total"</span><span class=p>},</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=w>    </span><span class=p>{</span><span class=nt>"expr"</span><span class=p>:</span><span class=w> </span><span class=s2>"reddit_joined_table_rows"</span><span class=p>}</span>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=w>  </span><span class=p>]</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a><span class=p>}</span>
</span></code></pre></div><p></p> </li> </ol> <h5 id=3-performance-dashboards>3. Performance Dashboards<a class=headerlink href=#3-performance-dashboards title="Permanent link">¶</a></h5> <p>Our Grafana dashboard is designed to visualize processing efficiency (task durations, volumes, success rates, resource utilization), data quality (DBT test results, validation metrics, processing status, error rates), and provide real-time monitoring.</p> <h5 id=4-mlflow-integration>4. MLflow Integration<a class=headerlink href=#4-mlflow-integration title="Permanent link">¶</a></h5> <p>MLflow's model versioning, experiment tracking, model serving, and artifact management features aid in model selection by allowing us to identify the best-performing models.</p> <h5 id=5-alert-configuration>5. Alert Configuration<a class=headerlink href=#5-alert-configuration title="Permanent link">¶</a></h5> <p>The system monitors critical thresholds for performance, including task duration, error rate spikes, resource exhaustion, and pipeline stalls. It also monitors quality thresholds, including data validation failures, model performance degradation, processing anomalies, and system health issues</p> <h2 id=results-and-impact>Results and Impact<a class=headerlink href=#results-and-impact title="Permanent link">¶</a></h2> <p>The pipeline successfully processes a thousand of Reddit posts daily, generates concise and meaningful summaries, identifies key trends and discussions, maintains high accuracy in content filtering, provides real-time insights through a web interface. </p> <h2 id=future-improvements>Future Improvements<a class=headerlink href=#future-improvements title="Permanent link">¶</a></h2> <ol> <li><strong>Enhanced Analysis</strong><ul> <li>Integration with additional AI models</li> <li>Advanced visualization features</li> <li>Real-time analysis capabilities</li> </ul> </li> <li><strong>System Scalability</strong><ul> <li>Distributed processing implementation</li> <li>Enhanced caching mechanisms</li> <li>API endpoint for analysis access</li> <li>Implement an OLAP database: use PostgreSQL to send the raw data to the OLAP database </li> </ul> </li> <li><strong>User Experience</strong><ul> <li>Interactive dashboard development</li> <li>Customizable analysis parameters</li> <li>Trend prediction features</li> </ul> </li> </ol> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">¶</a></h2> <p>This project showcases the power of automation in extracting valuable insights from social media using AI and data engineering, while handling real-world challenges. The open-source code is on GitHub, and welcome community contributions.</p> <h2 id=resources-and-references>Resources and References<a class=headerlink href=#resources-and-references title="Permanent link">¶</a></h2> <ul> <li><a href=https://github.com/SulmanK/reddit_ai_pulse_local_public>Project GitHub Repository</a></li> <li><a href=https://reddit-ai-pulse.vercel.app/ >Web Application</a></li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../../../2024/12/15/recsys-challenge-2024-model-selection/ class="md-footer__link md-footer__link--prev" aria-label="Previous: RecSys Challenge 2024: Model Selection"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> RecSys Challenge 2024: Model Selection </div> </div> </a> <a href=../../23/Reddit%20AI%20Pulse%20%28Cloud%29/ class="md-footer__link md-footer__link--next" aria-label="Next: From Reddit to Insights: Building an AI-Powered Data Pipeline with Gemini (Cloud)"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> From Reddit to Insights: Building an AI-Powered Data Pipeline with Gemini (Cloud) </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.linkedin.com/in/sulman-khan target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg> </a> <a href=https://github.com/sulmank target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "../../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../../../../javascripts/mathjax.js></script> <script src=../../../../../javascripts/analytics.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>