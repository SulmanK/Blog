<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../../../01/23/Reddit%20AI%20Pulse%20%28Cloud%29/ rel=prev><link href=../../31/beatdebate-technical-deep-dive/ rel=next><link rel=icon href=../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Concept Visualizer: An AI-Powered Design Tool - Technical Deep Dive - SulmanK Blog</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#concept-visualizer-an-ai-powered-design-tool-technical-deep-dive class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title="SulmanK Blog" class="md-header__button md-logo" aria-label="SulmanK Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> SulmanK Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Concept Visualizer: An AI-Powered Design Tool - Technical Deep Dive </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/SulmanK/blog/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> blog </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../../ class=md-tabs__link> Writing </a> </li> <li class=md-tabs__item> <a href=../../../../../contact/ class=md-tabs__link> Contact </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title="SulmanK Blog" class="md-nav__button md-logo" aria-label="SulmanK Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> SulmanK Blog </label> <div class=md-nav__source> <a href=https://github.com/SulmanK/blog/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> blog </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__container"> <a href=../../../../ class="md-nav__link "> <span class=md-ellipsis> Writing </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../archive/2025/ class=md-nav__link> <span class=md-ellipsis> 2025 </span> </a> </li> <li class=md-nav__item> <a href=../../../../archive/2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../category/ai/ class=md-nav__link> <span class=md-ellipsis> AI </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/agent/ class=md-nav__link> <span class=md-ellipsis> Agent </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/agentic-workflow/ class=md-nav__link> <span class=md-ellipsis> Agentic Workflow </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/cloud-architecture/ class=md-nav__link> <span class=md-ellipsis> Cloud Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/data-engineering/ class=md-nav__link> <span class=md-ellipsis> Data Engineering </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/data-science/ class=md-nav__link> <span class=md-ellipsis> Data Science </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/deep-learning-recommendation-models/ class=md-nav__link> <span class=md-ellipsis> Deep Learning Recommendation Models </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/exploratory-data-analysis/ class=md-nav__link> <span class=md-ellipsis> Exploratory Data Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/fastapi/ class=md-nav__link> <span class=md-ellipsis> FastAPI </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/full-stack/ class=md-nav__link> <span class=md-ellipsis> Full Stack </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/gcp/ class=md-nav__link> <span class=md-ellipsis> GCP </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/llms/ class=md-nav__link> <span class=md-ellipsis> LLMs </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/ml/ class=md-nav__link> <span class=md-ellipsis> ML </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/machine-learning/ class=md-nav__link> <span class=md-ellipsis> Machine Learning </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/model-selection/ class=md-nav__link> <span class=md-ellipsis> Model Selection </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/music-technology/ class=md-nav__link> <span class=md-ellipsis> Music Technology </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/react/ class=md-nav__link> <span class=md-ellipsis> React </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/recsys-challenge-2024/ class=md-nav__link> <span class=md-ellipsis> RecSys Challenge 2024 </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/recommendation-systems/ class=md-nav__link> <span class=md-ellipsis> Recommendation Systems </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/recommender-systems/ class=md-nav__link> <span class=md-ellipsis> Recommender Systems </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/terraform/ class=md-nav__link> <span class=md-ellipsis> Terraform </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/web-development/ class=md-nav__link> <span class=md-ellipsis> Web Development </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/cloud/ class=md-nav__link> <span class=md-ellipsis> cloud </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/end-to-end-pipeline/ class=md-nav__link> <span class=md-ellipsis> end-to-end pipeline </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../contact/ class=md-nav__link> <span class=md-ellipsis> Contact </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> <nav class=md-nav aria-label=Introduction> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-youll-learn class=md-nav__link> <span class=md-ellipsis> What You’ll Learn </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#system-architecture-a-modular-and-scalable-design class=md-nav__link> <span class=md-ellipsis> System Architecture: A Modular and Scalable Design </span> </a> <nav class=md-nav aria-label="System Architecture: A Modular and Scalable Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#build-path-diagram class=md-nav__link> <span class=md-ellipsis> Build Path Diagram </span> </a> </li> <li class=md-nav__item> <a href=#runtime-path-diagram class=md-nav__link> <span class=md-ellipsis> Runtime Path Diagram </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#getting-started-local-development class=md-nav__link> <span class=md-ellipsis> Getting Started &amp; Local Development </span> </a> </li> <li class=md-nav__item> <a href=#1-the-backend-python-fastapi-and-asynchronous-power class=md-nav__link> <span class=md-ellipsis> 1. The Backend: Python, FastAPI, and Asynchronous Power </span> </a> <nav class=md-nav aria-label="1. The Backend: Python, FastAPI, and Asynchronous Power"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-components-technologies class=md-nav__link> <span class=md-ellipsis> Key Components &amp; Technologies: </span> </a> <nav class=md-nav aria-label="Key Components & Technologies:"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fastapi class=md-nav__link> <span class=md-ellipsis> FastAPI </span> </a> </li> <li class=md-nav__item> <a href=#pydantic class=md-nav__link> <span class=md-ellipsis> Pydantic </span> </a> </li> <li class=md-nav__item> <a href=#layered-architecture class=md-nav__link> <span class=md-ellipsis> Layered Architecture </span> </a> <nav class=md-nav aria-label="Layered Architecture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram class=md-nav__link> <span class=md-ellipsis> Diagram </span> </a> </li> <li class=md-nav__item> <a href=#api-layer class=md-nav__link> <span class=md-ellipsis> API Layer </span> </a> </li> <li class=md-nav__item> <a href=#service-layer class=md-nav__link> <span class=md-ellipsis> Service Layer </span> </a> </li> <li class=md-nav__item> <a href=#core-layer class=md-nav__link> <span class=md-ellipsis> Core Layer </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#asynchronous-task-processing class=md-nav__link> <span class=md-ellipsis> Asynchronous Task Processing </span> </a> <nav class=md-nav aria-label="Asynchronous Task Processing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram_1 class=md-nav__link> <span class=md-ellipsis> Diagram </span> </a> </li> <li class=md-nav__item> <a href=#gcp-cloud-function-gen-2 class=md-nav__link> <span class=md-ellipsis> GCP Cloud Function (Gen 2) </span> </a> </li> <li class=md-nav__item> <a href=#pubsub-message-structure-example class=md-nav__link> <span class=md-ellipsis> Pub/Sub Message Structure (Example) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#database-storage-integration class=md-nav__link> <span class=md-ellipsis> Database &amp; Storage Integration </span> </a> </li> <li class=md-nav__item> <a href=#docker class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-the-frontend-react-vite-and-a-modern-ui class=md-nav__link> <span class=md-ellipsis> 2. The Frontend: React, Vite, and a Modern UI </span> </a> <nav class=md-nav aria-label="2. The Frontend: React, Vite, and a Modern UI"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-components-technologies_1 class=md-nav__link> <span class=md-ellipsis> Key Components &amp; Technologies: </span> </a> <nav class=md-nav aria-label="Key Components & Technologies:"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#react-19-vite class=md-nav__link> <span class=md-ellipsis> React 19 &amp; Vite </span> </a> </li> <li class=md-nav__item> <a href=#typescript class=md-nav__link> <span class=md-ellipsis> Typescript </span> </a> </li> <li class=md-nav__item> <a href=#styling class=md-nav__link> <span class=md-ellipsis> Styling </span> </a> <nav class=md-nav aria-label=Styling> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tailwind-css class=md-nav__link> <span class=md-ellipsis> Tailwind CSS </span> </a> </li> <li class=md-nav__item> <a href=#material-ui class=md-nav__link> <span class=md-ellipsis> Material-UI </span> </a> </li> <li class=md-nav__item> <a href=#css-modules class=md-nav__link> <span class=md-ellipsis> CSS Modules </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#state-management class=md-nav__link> <span class=md-ellipsis> State Management </span> </a> <nav class=md-nav aria-label="State Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#diagram_2 class=md-nav__link> <span class=md-ellipsis> Diagram </span> </a> </li> <li class=md-nav__item> <a href=#tanstack-query-react-query class=md-nav__link> <span class=md-ellipsis> TanStack Query (React Query) </span> </a> </li> <li class=md-nav__item> <a href=#react-context-api class=md-nav__link> <span class=md-ellipsis> React Context API </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#routing class=md-nav__link> <span class=md-ellipsis> Routing </span> </a> </li> <li class=md-nav__item> <a href=#api-client class=md-nav__link> <span class=md-ellipsis> API Client </span> </a> </li> <li class=md-nav__item> <a href=#component-architecture class=md-nav__link> <span class=md-ellipsis> Component Architecture </span> </a> </li> <li class=md-nav__item> <a href=#real-time-task-updates class=md-nav__link> <span class=md-ellipsis> Real-time Task Updates </span> </a> </li> <li class=md-nav__item> <a href=#testing class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=#example-asynchronous-concept-generation-ui-flow class=md-nav__link> <span class=md-ellipsis> Example: Asynchronous Concept Generation UI Flow </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-terraform-infrastructure-as-code-for-gcp class=md-nav__link> <span class=md-ellipsis> 3. Terraform: Infrastructure as Code for GCP </span> </a> <nav class=md-nav aria-label="3. Terraform: Infrastructure as Code for GCP"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-infrastructure-resources-design-decisions class=md-nav__link> <span class=md-ellipsis> Key Infrastructure Resources &amp; Design Decisions: </span> </a> <nav class=md-nav aria-label="Key Infrastructure Resources & Design Decisions:"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#networking class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class=md-nav__item> <a href=#iam-service-accounts class=md-nav__link> <span class=md-ellipsis> IAM &amp; Service Accounts </span> </a> </li> <li class=md-nav__item> <a href=#compute-engine class=md-nav__link> <span class=md-ellipsis> Compute Engine </span> </a> </li> <li class=md-nav__item> <a href=#cloud-function class=md-nav__link> <span class=md-ellipsis> Cloud Function </span> </a> </li> <li class=md-nav__item> <a href=#pubsub class=md-nav__link> <span class=md-ellipsis> Pub/Sub </span> </a> </li> <li class=md-nav__item> <a href=#secret-manager class=md-nav__link> <span class=md-ellipsis> Secret Manager </span> </a> </li> <li class=md-nav__item> <a href=#artifact-registry class=md-nav__link> <span class=md-ellipsis> Artifact Registry </span> </a> </li> <li class=md-nav__item> <a href=#cloud-storage class=md-nav__link> <span class=md-ellipsis> Cloud Storage </span> </a> </li> <li class=md-nav__item> <a href=#monitoring class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#environment-management-deployment-scripts class=md-nav__link> <span class=md-ellipsis> Environment Management &amp; Deployment Scripts: </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-github-actions-workflows class=md-nav__link> <span class=md-ellipsis> 4. GitHub Actions Workflows </span> </a> <nav class=md-nav aria-label="4. GitHub Actions Workflows"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#core-cicd-pipeline class=md-nav__link> <span class=md-ellipsis> Core CI/CD Pipeline: </span> </a> <nav class=md-nav aria-label="Core CI/CD Pipeline:"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#continuous-integration-tests class=md-nav__link> <span class=md-ellipsis> Continuous Integration tests </span> </a> </li> <li class=md-nav__item> <a href=#deploy-backend class=md-nav__link> <span class=md-ellipsis> Deploy Backend </span> </a> </li> <li class=md-nav__item> <a href=#playwright class=md-nav__link> <span class=md-ellipsis> Playwright </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-maintenance-workflows class=md-nav__link> <span class=md-ellipsis> Security &amp; Maintenance Workflows: </span> </a> <nav class=md-nav aria-label="Security & Maintenance Workflows:"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#environment-security class=md-nav__link> <span class=md-ellipsis> Environment Security </span> </a> </li> <li class=md-nav__item> <a href=#security-scan class=md-nav__link> <span class=md-ellipsis> Security Scan </span> </a> </li> <li class=md-nav__item> <a href=#schedule-cleanup class=md-nav__link> <span class=md-ellipsis> Schedule Cleanup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#key-workflow-features class=md-nav__link> <span class=md-ellipsis> Key Workflow Features: </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#external-services-integration class=md-nav__link> <span class=md-ellipsis> External Services Integration </span> </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content md-content--post" data-md-component=content> <div class="md-sidebar md-sidebar--post" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class="md-sidebar__inner md-post"> <nav class="md-nav md-nav--primary"> <div class=md-post__back> <div class="md-nav__title md-nav__container"> <a href=../../../../ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> <span class=md-ellipsis> Back to index </span> </a> </div> </div> <div class="md-post__authors md-typeset"> <div class="md-profile md-post__profile"> <span class="md-author md-author--long"> <img src="https://avatars.githubusercontent.com/u/43801845?v=4" alt="Sulman Khan"> </span> <span class=md-profile__description> <strong> <a href=https://github.com/SulmanK>Sulman Khan</a> </strong> <br> Creator </span> </div> </div> <ul class="md-post__meta md-nav__list"> <li class="md-nav__item md-nav__item--section"> <div class=md-post__title> <span class=md-ellipsis> Metadata </span> </div> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg> <time datetime="2025-05-19 00:00:00+00:00" class=md-ellipsis>2025/05/19</time> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg> <span class=md-ellipsis> in <a href=../../../../category/ai/ >AI</a>, <a href=../../../../category/web-development/ >Web Development</a>, <a href=../../../../category/cloud-architecture/ >Cloud Architecture</a>, <a href=../../../../category/full-stack/ >Full Stack</a>, <a href=../../../../category/gcp/ >GCP</a>, <a href=../../../../category/fastapi/ >FastAPI</a>, <a href=../../../../category/react/ >React</a>, <a href=../../../../category/terraform/ >Terraform</a></span> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg> <span class=md-ellipsis> 24 min read </span> </div> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <article class="md-content__inner md-typeset"> <a href=https://github.com/SulmanK/blog/edit/master/docs/writing/posts/concept_visualizer.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/SulmanK/blog/raw/master/docs/writing/posts/concept_visualizer.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=concept-visualizer-an-ai-powered-design-tool-technical-deep-dive>Concept Visualizer: An AI-Powered Design Tool - Technical Deep Dive<a class=headerlink href=#concept-visualizer-an-ai-powered-design-tool-technical-deep-dive title="Permanent link">&para;</a></h1> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <div class="admonition abstract"> <p class=admonition-title>Purpose</p> <p>This blog post documents the technical architecture and implementation of the <strong>Concept Visualizer</strong>, a web application designed to help users generate and refine visual concepts like logos and color palettes using AI. We'll explore the journey from an idea described in text to a set of visual assets, powered by a modern cloud-native stack.</p> <p>Check out the <a href=https://github.com/SulmanK/concept_visualizer>project GitHub repository</a> for the full code and detailed documentation. Here is the <a href=https://concept-visualizer-blush.vercel.app/ >web application</a>. </p> <!-- more --> </div> <div class="admonition info"> <p class=admonition-title>Problem Statement</p> <p>In the fast-paced world of branding and design, quickly translating abstract ideas into concrete visual representations is a significant challenge. Traditional design processes can be time-consuming and resource-intensive. The Concept Visualizer aims to streamline this by leveraging AI to generate initial designs and facilitate iterative refinement, making visual concept creation more accessible and efficient.</p> </div> <h3 id=what-youll-learn><strong>What You’ll Learn</strong><a class=headerlink href=#what-youll-learn title="Permanent link">&para;</a></h3> <ul> <li><strong>Architecting Decoupled Full-Stack Applications</strong>: Insights into structuring applications with a <strong>FastAPI</strong> backend and a <strong>React</strong> frontend for maintainability and scalability.</li> <li><strong>Integrating AI for Creative Generation</strong>: How the <strong>JigsawStack API</strong> is leveraged for AI-driven logo and color palette creation, including prompt engineering considerations.</li> <li><strong>Implementing Asynchronous Task Processing</strong>: Utilizing <strong>GCP Cloud Functions (Gen 2)</strong> and <strong>Pub/Sub</strong> to handle long-running AI tasks, ensuring a non-blocking user experience.</li> <li><strong>Mastering Infrastructure as Code (IaC)</strong>: Managing a complex, reproducible cloud infrastructure on <strong>Google Cloud Platform</strong> using <strong>Terraform</strong>.</li> <li><strong>Automating CI/CD Pipelines</strong>: Employing <strong>GitHub Actions</strong> for robust testing, Docker image building, and automated deployments to GCP and Vercel.</li> <li><strong>Securing Cloud Resources</strong>: Best practices for credential management with <strong>GCP Secret Manager</strong>, IAM, and <strong>Workload Identity Federation</strong>.</li> <li><strong>Designing Robust APIs</strong>: Implementing effective authentication, rate limiting (with <strong>Upstash Redis</strong>), and standardized error handling in FastAPI.</li> <li><strong>Developing Modern Frontends</strong>: Using <strong>TanStack Query</strong> for server state, React Context API (with <code>use-context-selector</code>) for global UI state, and <strong>Tailwind CSS</strong> for styling.</li> </ul> <h2 id=system-architecture-a-modular-and-scalable-design>System Architecture: A Modular and Scalable Design<a class=headerlink href=#system-architecture-a-modular-and-scalable-design title="Permanent link">&para;</a></h2> <p>The Concept Visualizer is built upon a modular architecture, ensuring scalability, maintainability, and clear separation of concerns. The system primarily consists of a user-facing frontend, a backend API to handle business logic and AI integration, cloud infrastructure to host these components, and automated workflows for CI/CD.</p> <h3 id=build-path-diagram>Build Path Diagram<a class=headerlink href=#build-path-diagram title="Permanent link">&para;</a></h3> <p><a class=glightbox href=../../../../img/cv_build_path_diagram.png data-type=image data-width=auto data-height=auto data-title="Build Path Diagram" data-desc-position=bottom><img alt="Build Path Diagram" src=../../../../img/cv_build_path_diagram.png></a> <!-- Make sure this path is correct --></p> <h3 id=runtime-path-diagram>Runtime Path Diagram<a class=headerlink href=#runtime-path-diagram title="Permanent link">&para;</a></h3> <p><a class=glightbox href=../../../../img/cv_runtime_path_diagram.png data-type=image data-width=auto data-height=auto data-title="Runtime Path Diagram" data-desc-position=bottom><img alt="Runtime Path Diagram" src=../../../../img/cv_runtime_path_diagram.png></a> <!-- Make sure this path is correct --></p> <p>The diagrams illustrates the flow:</p> <ol> <li><strong>User Interaction</strong>: Users engage with the <strong>React Frontend Application</strong>, built with Vite and TypeScript, and hosted on <strong>Vercel</strong>. Vercel was chosen for its excellent developer experience, global CDN, and seamless Git integration for frontend deployments.</li> <li><strong>API Communication</strong>: The frontend makes API calls, proxied by Vercel for <code>/api/*</code> paths, via HTTPS to the <strong>Backend API Server</strong>.</li> <li><strong>Backend Processing</strong>:<ul> <li>The API Server, a <strong>FastAPI application running on a GCP Compute Engine Managed Instance Group (MIG)</strong>, processes requests. FastAPI was selected for its high performance, asynchronous capabilities, and Pydantic-driven data validation.</li> <li><strong>Supabase</strong> handles authentication (Supabase Auth) and data persistence (PostgreSQL DB). It was chosen for its integrated BaaS features, simplifying user management and database setup with Row Level Security (RLS).</li> <li><strong>Upstash Redis</strong> serves as a high-performance cache for API rate limiting.</li> <li>The external <strong>JigsawStack API</strong> is the core AI engine for generating images and color palettes.</li> <li>Computationally intensive or long-running AI tasks are offloaded to a <strong>GCP Cloud Function (Gen 2) Worker</strong> via <strong>GCP Pub/Sub</strong> to ensure the API remains responsive.</li> </ul> </li> <li><strong>Asynchronous Tasks</strong>:<ul> <li>The Worker, triggered by Pub/Sub messages, performs AI calls to JigsawStack, processes images, and stores results (images and palettes) in <strong>Supabase Storage</strong>.</li> <li>Task status is tracked and updated in the Supabase database.</li> </ul> </li> <li><strong>Infrastructure &amp; DevOps</strong>:<ul> <li>The entire <strong>GCP Infrastructure</strong> is defined using <strong>Terraform</strong>, enabling version-controlled, reproducible environments.</li> <li><strong>GitHub Actions</strong> automate the CI/CD pipeline: building Docker images (stored in <strong>GCP Artifact Registry</strong>), deploying infrastructure changes via Terraform, deploying the frontend to Vercel, and executing security and maintenance workflows.</li> <li><strong>GCP Secret Manager</strong> securely stores all sensitive credentials.</li> <li><strong>GCP Cloud Monitoring</strong> provides observability with logs, metrics, and alert policies.</li> <li>A <strong>GCS Bucket</strong> is dedicated to storing Terraform state (ensuring collaborative and safe IaC practices) and static assets like VM startup scripts.</li> </ul> </li> </ol> <h2 id=getting-started-local-development>Getting Started &amp; Local Development<a class=headerlink href=#getting-started-local-development title="Permanent link">&para;</a></h2> <p>For those interested in running the Concept Visualizer locally or contributing to its development, here's a streamlined guide to get you up and running. For a more exhaustive setup guide, please refer to the <a href=https://github.com/SulmanK/concept-visualizer/blob/main/Design/Setup.md>Setup Documentation on GitHub</a>.</p> <hr> <h2 id=1-the-backend-python-fastapi-and-asynchronous-power>1. The Backend: Python, FastAPI, and Asynchronous Power<a class=headerlink href=#1-the-backend-python-fastapi-and-asynchronous-power title="Permanent link">&para;</a></h2> <p>The backend is the application's core, handling business logic, AI integration, and data persistence. Built with Python 3.11 and FastAPI, it’s designed for performance and scalability.</p> <h3 id=key-components-technologies>Key Components &amp; Technologies:<a class=headerlink href=#key-components-technologies title="Permanent link">&para;</a></h3> <h4 id=fastapi>FastAPI<a class=headerlink href=#fastapi title="Permanent link">&para;</a></h4> <ul> <li> <p>Chosen for its asynchronous nature (critical for I/O-bound operations like external API calls), high performance, and built-in data validation via Pydantic.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># backend/app/api/routes/concept/generation.py (Illustrative Snippet)</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kn>from</span><span class=w> </span><span class=nn>fastapi</span><span class=w> </span><span class=kn>import</span> <span class=n>APIRouter</span><span class=p>,</span> <span class=n>Depends</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=kn>from</span><span class=w> </span><span class=nn>app.models.concept.request</span><span class=w> </span><span class=kn>import</span> <span class=n>PromptRequest</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=kn>from</span><span class=w> </span><span class=nn>app.models.task.response</span><span class=w> </span><span class=kn>import</span> <span class=n>TaskResponse</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=kn>from</span><span class=w> </span><span class=nn>app.api.dependencies</span><span class=w> </span><span class=kn>import</span> <span class=n>CommonDependencies</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=n>router</span> <span class=o>=</span> <span class=n>APIRouter</span><span class=p>()</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=nd>@router</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;/generate-with-palettes&quot;</span><span class=p>,</span> <span class=n>response_model</span><span class=o>=</span><span class=n>TaskResponse</span><span class=p>)</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>generate_concept_with_palettes</span><span class=p>(</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>    <span class=n>request</span><span class=p>:</span> <span class=n>PromptRequest</span><span class=p>,</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    <span class=n>commons</span><span class=p>:</span> <span class=n>CommonDependencies</span> <span class=o>=</span> <span class=n>Depends</span><span class=p>(),</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>    <span class=c1># ... other params</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>TaskResponse</span><span class=p>:</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>    <span class=c1># ... logic to create and queue a task ...</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>    <span class=n>user_id</span> <span class=o>=</span> <span class=n>commons</span><span class=o>.</span><span class=n>user_id</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>    <span class=c1># ...</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>    <span class=n>task</span> <span class=o>=</span> <span class=k>await</span> <span class=n>commons</span><span class=o>.</span><span class=n>task_service</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>        <span class=n>user_id</span><span class=o>=</span><span class=n>user_id</span><span class=p>,</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>        <span class=n>task_type</span><span class=o>=</span><span class=s2>&quot;concept_generation&quot;</span><span class=p>,</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>        <span class=n>metadata</span><span class=o>=</span><span class=n>task_metadata</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>    <span class=p>)</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>    <span class=c1># ... publish to Pub/Sub ...</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>    <span class=k>return</span> <span class=n>TaskResponse</span><span class=p>(</span><span class=o>**</span><span class=n>task</span><span class=p>)</span> <span class=c1># Simplified</span>
</span></code></pre></div> </li> </ul> <h4 id=pydantic>Pydantic<a class=headerlink href=#pydantic title="Permanent link">&para;</a></h4> <ul> <li>Used for defining request/response models and settings, providing robust data validation and serialization, reducing runtime errors, and improving code clarity. <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># backend/app/models/concept/request.py (Illustrative Snippet)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=kn>from</span><span class=w> </span><span class=nn>pydantic</span><span class=w> </span><span class=kn>import</span> <span class=n>BaseModel</span><span class=p>,</span> <span class=n>Field</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=k>class</span><span class=w> </span><span class=nc>PromptRequest</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>    <span class=n>logo_description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>        <span class=o>...</span><span class=p>,</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>        <span class=n>min_length</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>        <span class=n>max_length</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>        <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Description of the logo to generate&quot;</span><span class=p>,</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>    <span class=p>)</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>    <span class=n>theme_description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>        <span class=o>...</span><span class=p>,</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>        <span class=n>min_length</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>        <span class=n>max_length</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>        <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Description of the theme/color scheme to generate&quot;</span><span class=p>,</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>    <span class=p>)</span>
</span></code></pre></div></li> </ul> <h4 id=layered-architecture>Layered Architecture<a class=headerlink href=#layered-architecture title="Permanent link">&para;</a></h4> <h5 id=diagram>Diagram<a class=headerlink href=#diagram title="Permanent link">&para;</a></h5> <p><a class=glightbox href=../../../../img/cv_backend_diagram.png data-type=image data-width=auto data-height=auto data-title=Backend data-desc-position=bottom><img alt=Backend src=../../../../img/cv_backend_diagram.png></a> </p> <h5 id=api-layer>API Layer<a class=headerlink href=#api-layer title="Permanent link">&para;</a></h5> <ul> <li><strong>(<code>backend/app/api/</code>):</strong><ul> <li>Handles HTTP requests, validates inputs with Pydantic models, and formats responses.</li> <li>Routes are logically grouped by domain (e.g., <code>auth</code>, <code>concepts</code>, <code>tasks</code>). A central router in <code>backend/app/api/router.py</code> combines these.</li> <li>Middleware is crucial:<ul> <li><code>AuthMiddleware</code> (<code>backend/app/api/middleware/auth_middleware.py</code>): Integrates with Supabase Auth for JWT-based authentication. <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># backend/app/api/middleware/auth_middleware.py (Illustrative Snippet)</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=k>class</span><span class=w> </span><span class=nc>AuthMiddleware</span><span class=p>(</span><span class=n>BaseHTTPMiddleware</span><span class=p>):</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>dispatch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>call_next</span><span class=p>:</span> <span class=n>RequestResponseEndpoint</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Response</span><span class=p>:</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_is_public_path</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>path</span><span class=p>):</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>            <span class=k>return</span> <span class=k>await</span> <span class=n>call_next</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>            <span class=n>user</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>supabase_auth</span><span class=o>.</span><span class=n>get_user_from_request</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>            <span class=n>request</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>user</span> <span class=o>=</span> <span class=n>user</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>        <span class=k>except</span> <span class=n>AuthenticationError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>            <span class=k>return</span> <span class=n>JSONResponse</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>401</span><span class=p>,</span> <span class=n>content</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;detail&quot;</span><span class=p>:</span> <span class=n>e</span><span class=o>.</span><span class=n>message</span><span class=p>})</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>        <span class=k>return</span> <span class=k>await</span> <span class=n>call_next</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></code></pre></div></li> <li><code>RateLimitApplyMiddleware</code> &amp; <code>RateLimitHeadersMiddleware</code> (<code>backend/app/api/middleware/</code>): Manage API usage quotas using SlowAPI with an Upstash Redis backend. The middleware order (Auth -&gt; Rate Limiting) is vital so that authenticated users can be identified for personalized limits. <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># backend/app/api/middleware/rate_limit_apply.py (Illustrative Snippet)</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=c1># RATE_LIMIT_RULES = { &quot;/concepts/generate&quot;: &quot;10/month&quot;, ... }</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=k>class</span><span class=w> </span><span class=nc>RateLimitApplyMiddleware</span><span class=p>(</span><span class=n>BaseHTTPMiddleware</span><span class=p>):</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>dispatch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>:</span> <span class=n>Request</span><span class=p>,</span> <span class=n>call_next</span><span class=p>:</span> <span class=n>Callable</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Response</span><span class=p>:</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>        <span class=c1># ... skip if public or disabled ...</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>        <span class=n>user_id</span> <span class=o>=</span> <span class=n>get_user_id</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>        <span class=n>limit_info</span> <span class=o>=</span> <span class=n>check_rate_limit</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span> <span class=n>endpoint</span><span class=p>,</span> <span class=n>rule</span><span class=p>)</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>        <span class=k>if</span> <span class=n>limit_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;exceeded&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>            <span class=k>raise</span> <span class=n>HTTPException</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=mi>429</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>        <span class=n>request</span><span class=o>.</span><span class=n>state</span><span class=o>.</span><span class=n>limiter_info</span> <span class=o>=</span> <span class=n>limit_info</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>        <span class=k>return</span> <span class=k>await</span> <span class=n>call_next</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></code></pre></div></li> </ul> </li> </ul> </li> </ul> <h5 id=service-layer>Service Layer<a class=headerlink href=#service-layer title="Permanent link">&para;</a></h5> <ul> <li><strong>(<code>backend/app/services/</code>):</strong><ul> <li>Encapsulates core business logic.</li> <li><code>ConceptService</code> (<code>backend/app/services/concept/service.py</code>): Orchestrates generation (calling <code>JigsawStackClient</code>), interacts with <code>ImageService</code>, and uses <code>PersistenceService</code>s. <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># backend/app/services/concept/service.py (Illustrative Snippet)</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>class</span><span class=w> </span><span class=nc>ConceptService</span><span class=p>(</span><span class=n>ConceptServiceInterface</span><span class=p>):</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>generate_concept</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>logo_description</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>theme_description</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>        <span class=n>image_response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>generate_image</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=n>logo_description</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>        <span class=n>image_url</span> <span class=o>=</span> <span class=n>image_response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;url&quot;</span><span class=p>)</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>        <span class=c1># ... download, process, persist if user_id and not skip_persistence ...</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;image_url&quot;</span><span class=p>:</span> <span class=n>final_image_url</span><span class=p>,</span> <span class=o>...</span><span class=p>}</span>
</span></code></pre></div></li> <li><code>TaskService</code> (<code>backend/app/services/task/service.py</code>): Manages background task lifecycles. <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># backend/app/services/task/service.py (Illustrative Snippet)</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=k>class</span><span class=w> </span><span class=nc>TaskService</span><span class=p>(</span><span class=n>TaskServiceInterface</span><span class=p>):</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>create_task</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>task_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>        <span class=n>task_data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span> <span class=s2>&quot;user_id&quot;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=o>...</span><span class=p>}</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>table</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>tasks_table</span><span class=p>)</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>task_data</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>        <span class=c1># ... error handling ...</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>        <span class=k>return</span> <span class=n>result</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></code></pre></div></li> <li>Services often implement interfaces (e.g., <code>ConceptServiceInterface</code>) for loose coupling and testability.</li> </ul> </li> </ul> <h5 id=core-layer>Core Layer<a class=headerlink href=#core-layer title="Permanent link">&para;</a></h5> <ul> <li><strong>(<code>backend/app/core/</code>):</strong><ul> <li><code>config.py</code>: Defines application settings using Pydantic's <code>BaseSettings</code>. <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># backend/app/core/config.py (Illustrative Snippet)</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=k>class</span><span class=w> </span><span class=nc>Settings</span><span class=p>(</span><span class=n>BaseSettings</span><span class=p>):</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>    <span class=n>JIGSAWSTACK_API_KEY</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;dummy_key&quot;</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>    <span class=n>SUPABASE_URL</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;https://your-project-id.supabase.co&quot;</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>    <span class=c1># ... other settings ...</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>    <span class=n>model_config</span> <span class=o>=</span> <span class=n>SettingsConfigDict</span><span class=p>(</span><span class=n>env_prefix</span><span class=o>=</span><span class=s2>&quot;CONCEPT_&quot;</span><span class=p>)</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=n>settings</span> <span class=o>=</span> <span class=n>Settings</span><span class=p>()</span>
</span></code></pre></div></li> <li><code>factory.py</code>: Contains <code>create_app</code> to initialize the FastAPI app. <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># backend/app/core/factory.py (Illustrative Snippet)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=k>def</span><span class=w> </span><span class=nf>create_app</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>FastAPI</span><span class=p>:</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>    <span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>    <span class=c1># ... configure CORS, middleware, routes, rate limiter ...</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>    <span class=n>app</span><span class=o>.</span><span class=n>add_middleware</span><span class=p>(</span><span class=n>AuthMiddleware</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>    <span class=n>configure_api_routes</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=n>setup_limiter_for_app</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>    <span class=k>return</span> <span class=n>app</span>
</span></code></pre></div></li> <li>Custom exceptions (<code>exceptions.py</code>) provide domain-specific error handling.</li> </ul> </li> </ul> <h4 id=asynchronous-task-processing>Asynchronous Task Processing<a class=headerlink href=#asynchronous-task-processing title="Permanent link">&para;</a></h4> <h5 id=diagram_1>Diagram<a class=headerlink href=#diagram_1 title="Permanent link">&para;</a></h5> <p><a class=glightbox href=../../../../img/cv_task_processing_diagram.png data-type=image data-width=auto data-height=auto data-title="Task Processing" data-desc-position=bottom><img alt="Task Processing" src=../../../../img/cv_task_processing_diagram.png></a></p> <ul> <li><strong>(<code>backend/cloud_run/worker/</code>):</strong><ul> <li><strong>Rationale</strong>: AI image generation can be time-consuming. Offloading these tasks to an asynchronous worker prevents API timeouts and provides a better user experience.</li> </ul> </li> </ul> <h5 id=gcp-cloud-function-gen-2>GCP Cloud Function (Gen 2)<a class=headerlink href=#gcp-cloud-function-gen-2 title="Permanent link">&para;</a></h5> <ul> <li>Chosen for its container support, longer execution timeout, and seamless Pub/Sub integration.<ul> <li>The worker entry point is <code>handle_pubsub</code> in <code>main.py</code>, triggered by Pub/Sub messages. <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># backend/cloud_run/worker/main.py (Illustrative Snippet)</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=nd>@functions_framework</span><span class=o>.</span><span class=n>cloud_event</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>def</span><span class=w> </span><span class=nf>handle_pubsub</span><span class=p>(</span><span class=n>cloud_event</span><span class=p>:</span> <span class=n>CloudEvent</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>_async_handle_pubsub</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>        <span class=c1># ... decode message_payload from cloud_event ...</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>        <span class=k>await</span> <span class=n>process_pubsub_message</span><span class=p>(</span><span class=n>message_payload</span><span class=p>,</span> <span class=n>SERVICES_GLOBAL</span><span class=p>)</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>_async_handle_pubsub</span><span class=p>())</span>
</span></code></pre></div></li> <li><code>process_pubsub_message</code> instantiates task-specific processors (<code>GenerationTaskProcessor</code>, <code>RefinementTaskProcessor</code>). <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># backend/cloud_run/worker/main.py (Illustrative Snippet)</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>process_pubsub_message</span><span class=p>(</span><span class=n>message</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>services</span><span class=p>:</span> <span class=n>ServicesDict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=n>task_type</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;task_type&quot;</span><span class=p>)</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>    <span class=k>if</span> <span class=n>task_type</span> <span class=o>==</span> <span class=n>TASK_TYPE_GENERATION</span><span class=p>:</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>        <span class=n>processor</span> <span class=o>=</span> <span class=n>GenerationTaskProcessor</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>    <span class=c1># ...</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>    <span class=k>if</span> <span class=n>processor</span><span class=p>:</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>        <span class=k>await</span> <span class=n>processor</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</span></code></pre></div></li> <li>Processors like <code>GenerationTaskProcessor</code> (<code>backend/cloud_run/worker/processors/generation_processor.py</code>) manage the task lifecycle. <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># backend/cloud_run/worker/processors/generation_processor.py (Illustrative Snippet)</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>class</span><span class=w> </span><span class=nc>GenerationTaskProcessor</span><span class=p>(</span><span class=n>BaseTaskProcessor</span><span class=p>):</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>        <span class=k>if</span> <span class=ow>not</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_claim_task</span><span class=p>():</span> <span class=k>return</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>            <span class=n>concept_response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_generate_base_image</span><span class=p>()</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>            <span class=n>image_data</span> <span class=o>=</span> <span class=k>await</span> <span class=n>prepare_image_data_from_response</span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>            <span class=c1># ... store image, generate palettes, create variations, store concept ...</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_task_completed</span><span class=p>(</span><span class=n>concept_id</span><span class=p>)</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>            <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_update_task_failed</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>))</span>
</span></code></pre></div></li> </ul> </li> </ul> <h5 id=pubsub-message-structure-example>Pub/Sub Message Structure (Example)<a class=headerlink href=#pubsub-message-structure-example title="Permanent link">&para;</a></h5> <ul> <li><code>json { "task_id": "unique-task-uuid", "user_id": "user-uuid", "task_type": "concept_generation", "logo_description": "A futuristic cat logo", "theme_description": "Neon and dark mode", "num_palettes": 5 }</code></li> </ul> <h4 id=database-storage-integration>Database &amp; Storage Integration<a class=headerlink href=#database-storage-integration title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>backend/app/core/supabase/</code>):</strong><ul> <li><strong>Supabase:</strong> Selected as a BaaS for its integrated PostgreSQL, Auth, Storage, and Realtime features.</li> <li><code>SupabaseClient</code> and <code>SupabaseAuthClient</code> (<code>client.py</code>) provide typed interfaces. <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># backend/app/core/supabase/client.py (Illustrative Snippet)</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=k>class</span><span class=w> </span><span class=nc>SupabaseClient</span><span class=p>:</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>url</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=o>...</span><span class=p>):</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>create_client</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>url</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_service_role_client</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span> <span class=c1># Returns a new client instance</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>        <span class=k>return</span> <span class=n>create_client</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>url</span><span class=p>,</span> <span class=n>settings</span><span class=o>.</span><span class=n>SUPABASE_SERVICE_ROLE</span><span class=p>)</span>
</span></code></pre></div></li> <li><code>ConceptStorage</code> and <code>ImageStorage</code> (<code>concept_storage.py</code>, <code>image_storage.py</code>) encapsulate data and file operations. <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># backend/app/core/supabase/concept_storage.py (Illustrative Snippet)</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=k>class</span><span class=w> </span><span class=nc>ConceptStorage</span><span class=p>:</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=k>def</span><span class=w> </span><span class=nf>store_concept</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>concept_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>table</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>concepts_table</span><span class=p>)</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=n>insert_data</span><span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>()</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>        <span class=c1># ...</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span> <span class=k>else</span> <span class=kc>None</span>
</span></code></pre></div></li> <li><strong>Security:</strong> RLS policies in Supabase (defined in <code>.sql</code> files in <code>backend/scripts/</code>) protect user data. The Cloud Function worker uses the <code>SERVICE_ROLE_KEY</code> to bypass RLS for system operations.</li> </ul> </li> </ul> <h4 id=docker>Docker<a class=headerlink href=#docker title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>backend/Dockerfile</code>, <code>backend/Dockerfile.worker</code>):</strong><ul> <li>The API server uses a multi-stage Dockerfile for optimized builds. <div class="language-dockerfile highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c># backend/Dockerfile (Illustrative Snippet)</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>base</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=c># ... install OS deps ...</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=k>FROM</span><span class=w> </span><span class=s>base</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>builder</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>uv
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=k>COPY</span><span class=w> </span>pyproject.toml<span class=w> </span>README.md<span class=w> </span>./
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=k>COPY</span><span class=w> </span>app<span class=w> </span>/app/app
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=k>RUN</span><span class=w> </span>uv<span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--system<span class=w> </span>--no-cache<span class=w> </span>-e<span class=w> </span>.<span class=o>[</span>dev<span class=o>]</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=k>FROM</span><span class=w> </span><span class=s>base</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>/usr/local<span class=w> </span>/usr/local
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=c># ... copy source, CMD ...</span>
</span></code></pre></div></li> <li><code>Dockerfile.worker</code> includes specific dependencies like OpenCV native libraries for the Cloud Function.</li> </ul> </li> </ul> <hr> <h2 id=2-the-frontend-react-vite-and-a-modern-ui>2. The Frontend: React, Vite, and a Modern UI<a class=headerlink href=#2-the-frontend-react-vite-and-a-modern-ui title="Permanent link">&para;</a></h2> <p>The frontend is a single-page application (SPA) built with React 19, Vite, and TypeScript, focused on delivering a responsive and interactive user experience.</p> <h3 id=key-components-technologies_1>Key Components &amp; Technologies:<a class=headerlink href=#key-components-technologies_1 title="Permanent link">&para;</a></h3> <h4 id=react-19-vite>React 19 &amp; Vite<a class=headerlink href=#react-19-vite title="Permanent link">&para;</a></h4> <ul> <li>Vite provides an extremely fast development server with Hot Module Replacement (HMR) and optimized production builds. React 19 (or latest stable at time of project) brings features for enhanced performance and developer experience.</li> </ul> <h4 id=typescript>Typescript<a class=headerlink href=#typescript title="Permanent link">&para;</a></h4> <ul> <li>Ensures type safety across the codebase, reducing runtime errors and improving code maintainability.</li> </ul> <h4 id=styling>Styling<a class=headerlink href=#styling title="Permanent link">&para;</a></h4> <h5 id=tailwind-css>Tailwind CSS<a class=headerlink href=#tailwind-css title="Permanent link">&para;</a></h5> <ul> <li>Leveraged for its utility-first approach, enabling rapid and consistent UI development. <div class="language-css highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c>/* frontend/my-app/tailwind.config.js (Illustrative Snippet) */</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=nt>module</span><span class=p>.</span><span class=nc>exports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=w>    </span><span class=k>content</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;./src/**/*.{js,ts,jsx,tsx}&quot;</span><span class=p>],</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=w>    </span><span class=n>theme</span><span class=o>:</span><span class=w> </span><span class=err>{</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=w>    </span><span class=n>extend</span><span class=o>:</span><span class=w> </span><span class=err>{</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=w>        </span><span class=n>colors</span><span class=o>:</span><span class=w> </span><span class=err>{</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>        </span><span class=n>primary</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;#4F46E5&quot;</span><span class=p>,</span><span class=w> </span><span class=o>//</span><span class=w> </span><span class=n>Defined</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=n>variables</span><span class=o>.</span><span class=n>css</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>        </span><span class=s2>&quot;primary-dark&quot;</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;#4338CA&quot;</span><span class=p>,</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=o>...</span><span class=w> </span><span class=n>other</span><span class=w> </span><span class=n>custom</span><span class=w> </span><span class=n>colors</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>        </span><span class=p>}</span><span class=o>,</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>        </span><span class=nt>boxShadow</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>        </span><span class=n>modern</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;0 10px 30px -5px rgba(79, 70, 229, 0.2)&quot;</span><span class=p>,</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=w>        </span><span class=p>}</span><span class=o>,</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=w>    </span><span class=err>}</span><span class=o>,</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=w>    </span><span class=err>}</span><span class=o>,</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=w>    </span><span class=nt>plugins</span><span class=o>:</span><span class=w> </span><span class=o>[</span><span class=nt>require</span><span class=o>(</span><span class=s2>&quot;@tailwindcss/forms&quot;</span><span class=o>)],</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=err>}</span><span class=o>;</span>
</span></code></pre></div></li> </ul> <h5 id=material-ui>Material-UI<a class=headerlink href=#material-ui title="Permanent link">&para;</a></h5> <ul> <li>Utilized for some pre-built, accessible UI components (e.g., Modals, Buttons), customized via a central theme in <code>theme.tsx</code>. <div class="language-tsx highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1>// frontend/my-app/src/theme.tsx (Illustrative Snippet)</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createTheme</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;@mui/material/styles&quot;</span><span class=p>;</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>theme</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createTheme</span><span class=p>({</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span><span class=nx>palette</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>    </span><span class=nx>primary</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>main</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;#4F46E5&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>    </span><span class=c1>// ... other palette settings</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=w>    </span><span class=nx>typography</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>fontFamily</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;&quot;Montserrat&quot;, sans-serif&#39;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=w>    </span><span class=nx>components</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=w>    </span><span class=nx>MuiButton</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>styleOverrides</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>root</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>textTransform</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;none&quot;</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=p>});</span>
</span></code></pre></div></li> </ul> <h5 id=css-modules>CSS Modules<a class=headerlink href=#css-modules title="Permanent link">&para;</a></h5> <ul> <li>Applied for component-scoped styling where necessary (e.g., <code>frontend/my-app/src/components/concept/ConceptResult.module.css</code>).</li> <li>Custom animations are defined in <code>frontend/my-app/src/styles/animations.css</code>, respecting <code>prefers-reduced-motion</code>.</li> </ul> <h4 id=state-management>State Management<a class=headerlink href=#state-management title="Permanent link">&para;</a></h4> <ul> <li>The frontend employs a combination of TanStack Query for server state and React Context API (optimized with <code>use-context-selector</code>) for global UI state. This provides a robust and performant approach to managing application data.</li> </ul> <h5 id=diagram_2>Diagram<a class=headerlink href=#diagram_2 title="Permanent link">&para;</a></h5> <p><a class=glightbox href=../../../../img/cv_state_management_diagram.png data-type=image data-width=auto data-height=auto data-title="State Management" data-desc-position=bottom><img alt="State Management" src=../../../../img/cv_state_management_diagram.png></a></p> <h5 id=tanstack-query-react-query>TanStack Query (React Query)<a class=headerlink href=#tanstack-query-react-query title="Permanent link">&para;</a></h5> <ul> <li>The primary tool for managing server state. It handles data fetching, caching, background updates, and mutations for concepts, tasks, and API rate limits. Centralized query keys in <code>frontend/my-app/src/config/queryKeys.ts</code> ensure consistent cache management and invalidation. <div class="language-typescript highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1>// frontend/my-app/src/hooks/useConceptQueries.ts (Illustrative Snippet)</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useQuery</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;@tanstack/react-query&quot;</span><span class=p>;</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>queryKeys</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../config/queryKeys&quot;</span><span class=p>;</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>fetchRecentConceptsFromApi</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../services/conceptService&quot;</span><span class=p>;</span><span class=w> </span><span class=c1>// Assumes this function exists</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>useRecentConcepts</span><span class=p>(</span><span class=nx>userId?</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=o>:</span><span class=w> </span><span class=kt>number</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>10</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>useQuery</span><span class=p>({</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>    </span><span class=nx>queryKey</span><span class=o>:</span><span class=w> </span><span class=kt>queryKeys.concepts.recent</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>),</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=w>    </span><span class=nx>queryFn</span><span class=o>:</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>userId</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>([]);</span><span class=w> </span><span class=c1>// Or handle as needed</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>fetchRecentConceptsFromApi</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span><span class=w> </span><span class=nx>limit</span><span class=p>);</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=w>    </span><span class=nx>enabled</span><span class=o>:</span><span class=w> </span><span class=o>!!</span><span class=nx>userId</span><span class=p>,</span><span class=w> </span><span class=c1>// Only fetch if userId is available</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=w>    </span><span class=nx>staleTime</span><span class=o>:</span><span class=w> </span><span class=kt>60</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>1000</span><span class=p>,</span><span class=w> </span><span class=c1>// 1 minute</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=p>}</span>
</span></code></pre></div></li> </ul> <h5 id=react-context-api>React Context API<a class=headerlink href=#react-context-api title="Permanent link">&para;</a></h5> <ul> <li>Manages global UI-related state such as authentication (<code>AuthContext</code>), active background task tracking (<code>TaskContext</code>), and API rate limit display (<code>RateLimitContext</code>). <code>use-context-selector</code> optimizes performance by allowing components to subscribe to only specific parts of a context, preventing unnecessary re-renders. <div class="language-tsx highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1>// frontend/my-app/src/contexts/AuthContext.tsx (Illustrative Snippet)</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createContext</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;use-context-selector&quot;</span><span class=p>;</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=c1>// ... other imports and AuthContextType definition ...</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>AuthContext</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createContext</span><span class=p>&lt;</span><span class=nt>AuthContextType</span><span class=w> </span><span class=err>|</span><span class=w> </span><span class=na>undefined</span><span class=p>&gt;(</span><span class=kc>undefined</span><span class=p>);</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>AuthProvider</span><span class=o>:</span><span class=w> </span><span class=kt>React.FC</span><span class=o>&lt;</span><span class=p>{</span><span class=w> </span><span class=nx>children</span><span class=o>:</span><span class=w> </span><span class=kt>React.ReactNode</span><span class=w> </span><span class=p>}</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>({</span><span class=w> </span><span class=nx>children</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>    </span><span class=c1>// ... state and logic for session, user, isLoading, error ...</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>    </span><span class=c1>// ... signOut, linkEmail functions ...</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useMemo</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>({</span><span class=w> </span><span class=nx>session</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=p>,</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}),</span><span class=w> </span><span class=p>[</span><span class=nx>session</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=p>,</span><span class=w> </span><span class=p>...]);</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>&lt;</span><span class=nt>AuthContext</span><span class=p>.</span><span class=na>Provider</span><span class=w> </span><span class=na>value</span><span class=o>=</span><span class=p>{</span><span class=nx>value</span><span class=p>}&gt;{</span><span class=nx>children</span><span class=p>}&lt;/</span><span class=nt>AuthContext</span><span class=p>.</span><span class=na>Provider</span><span class=p>&gt;;</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=p>};</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=c1>// frontend/my-app/src/hooks/useAuth.ts (Illustrative Snippet for selector hook)</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useContextSelector</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;use-context-selector&quot;</span><span class=p>;</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>AuthContext</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;../contexts/AuthContext&quot;</span><span class=p>;</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>useUserId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>useContextSelector</span><span class=p>(</span><span class=nx>AuthContext</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>state</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>state</span><span class=o>?</span><span class=p>.</span><span class=nx>user</span><span class=o>?</span><span class=p>.</span><span class=nx>id</span><span class=p>);</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=p>};</span>
</span></code></pre></div></li> </ul> <h4 id=routing>Routing<a class=headerlink href=#routing title="Permanent link">&para;</a></h4> <ul> <li><strong>React Router</strong>: Manages client-side navigation. Routes are defined in <code>App.tsx</code>.</li> <li><strong>Framer Motion</strong>: Used for smooth page transitions and component animations, enhancing the user experience.</li> </ul> <h4 id=api-client>API Client<a class=headerlink href=#api-client title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>frontend/my-app/src/services/apiClient.ts</code>):</strong><ul> <li>A centralized Axios instance handles all HTTP communication with the backend.</li> <li><strong>Interceptors</strong> are key:<ul> <li>A request interceptor automatically fetches the current Supabase session and attaches the JWT <code>access_token</code> to the <code>Authorization</code> header. <div class="language-typescript highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1>// frontend/my-app/src/services/apiClient.ts (Request Interceptor Snippet)</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=nx>axiosInstance</span><span class=p>.</span><span class=nx>interceptors</span><span class=p>.</span><span class=nx>request</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=w>  </span><span class=k>async</span><span class=w> </span><span class=p>(</span><span class=nx>config</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>data</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>session</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>supabase</span><span class=p>.</span><span class=nx>auth</span><span class=p>.</span><span class=nx>getSession</span><span class=p>();</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>session</span><span class=o>?</span><span class=p>.</span><span class=nx>access_token</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w>      </span><span class=nx>config</span><span class=p>.</span><span class=nx>headers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>headers</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{};</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>      </span><span class=nx>config</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>Authorization</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`Bearer </span><span class=si>${</span><span class=nx>session</span><span class=p>.</span><span class=nx>access_token</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>config</span><span class=p>;</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=cm>/* ... error handling ... */</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=p>);</span>
</span></code></pre></div></li> <li>A response interceptor handles API errors, parses rate limit headers (updating <code>RateLimitContext</code>), and implements a token refresh mechanism for 401 Unauthorized errors. If token refresh fails, it dispatches a global event (<code>auth-error-needs-logout</code>) handled by <code>AuthContext</code>. <div class="language-typescript highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1>// frontend/my-app/src/services/apiClient.ts (Response Error Interceptor Snippet - Simplified)</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=nx>axiosInstance</span><span class=p>.</span><span class=nx>interceptors</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=w>  </span><span class=p>(</span><span class=nx>response</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* ... handle rate limits ... */</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>response</span><span class=p>;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>  </span><span class=k>async</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>originalRequest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>error</span><span class=p>.</span><span class=nx>config</span><span class=p>;</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>response</span><span class=o>?</span><span class=p>.</span><span class=nx>status</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>401</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=nx>originalRequest</span><span class=p>.</span><span class=nx>_retry</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>      </span><span class=nx>originalRequest</span><span class=p>.</span><span class=nx>_retry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>      </span><span class=c1>// ... attempt supabase.auth.refreshSession() ...</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>      </span><span class=c1>// if successful, retry originalRequest with new token</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>      </span><span class=c1>// if failed, dispatch &#39;auth-error-needs-logout&#39;</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>    </span><span class=c1>// ... parse other errors into custom error classes ...</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=nx>parsedError</span><span class=p>);</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=p>);</span>
</span></code></pre></div></li> </ul> </li> <li>Custom error classes (<code>RateLimitError</code>, <code>AuthError</code>, <code>ValidationError</code>, etc.) are thrown by the client, providing structured error information.</li> </ul> </li> </ul> <h4 id=component-architecture>Component Architecture<a class=headerlink href=#component-architecture title="Permanent link">&para;</a></h4> <ul> <li>Organized into <code>ui/</code> (primitive reusable components like <code>Button</code>, <code>Card</code>), <code>layout/</code> (Header, Footer, <code>MainLayout</code>), and <code>features/</code> (domain-specific components like <code>ConceptForm</code>, <code>ConceptDetailPage</code>).</li> <li><code>OptimizedImage</code> (<code>frontend/my-app/src/components/ui/OptimizedImage.tsx</code>) component handles lazy loading and placeholders for better perceived performance.</li> <li><code>ErrorBoundary</code> components (<code>frontend/my-app/src/components/ui/ErrorBoundary.tsx</code>) catch rendering errors.</li> </ul> <h4 id=real-time-task-updates>Real-time Task Updates<a class=headerlink href=#real-time-task-updates title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>frontend/my-app/src/hooks/useTaskSubscription.ts</code>):</strong><ul> <li>Leverages Supabase Realtime capabilities to subscribe to PostgreSQL changes on the <code>tasks</code> table. <div class="language-typescript highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1>// frontend/my-app/src/hooks/useTaskSubscription.ts (Illustrative Snippet)</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>useTaskSubscription</span><span class=p>(</span><span class=nx>taskId</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>    </span><span class=c1>// ... state for taskData, error, status ...</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>taskId</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>channel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>supabase</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>            </span><span class=p>.</span><span class=nx>channel</span><span class=p>(</span><span class=sb>`task-updates-</span><span class=si>${</span><span class=nx>taskId</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>            </span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s2>&quot;postgres_changes&quot;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>event</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;UPDATE&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>schema</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;public&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>table</span><span class=o>:</span><span class=w> </span><span class=kt>tasksTable</span><span class=p>,</span><span class=w> </span><span class=nx>filter</span><span class=o>:</span><span class=w> </span><span class=sb>`id=eq.</span><span class=si>${</span><span class=nx>taskId</span><span class=si>}</span><span class=sb>`</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>                </span><span class=p>(</span><span class=nx>payload</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>                    </span><span class=c1>// Update local state and React Query cache with payload.new</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>            </span><span class=p>)</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=w>            </span><span class=p>.</span><span class=nx>subscribe</span><span class=p>();</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>        </span><span class=c1>// ... handle subscription status, cleanup ...</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>supabase</span><span class=p>.</span><span class=nx>removeChannel</span><span class=p>(</span><span class=nx>channel</span><span class=p>);</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>taskId</span><span class=p>,</span><span class=w> </span><span class=nx>tasksTable</span><span class=p>]);</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=w>    </span><span class=c1>// ... return { taskData, error, status } ...</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=p>}</span>
</span></code></pre></div></li> <li>When a task's status is updated in the backend, the frontend receives a real-time notification, allowing for immediate UI updates in components like the <code>TaskStatusBar</code>.</li> </ul> </li> </ul> <h4 id=testing>Testing<a class=headerlink href=#testing title="Permanent link">&para;</a></h4> <ul> <li>Unit/Integration tests with <strong>Vitest</strong> and <strong>React Testing Library</strong>.</li> <li>E2E, visual regression, and accessibility tests with <strong>Playwright</strong>.</li> </ul> <h4 id=example-asynchronous-concept-generation-ui-flow>Example: Asynchronous Concept Generation UI Flow<a class=headerlink href=#example-asynchronous-concept-generation-ui-flow title="Permanent link">&para;</a></h4> <ol> <li>User fills the <code>ConceptForm</code> (in <code>ConceptFormSection</code> on <code>LandingPage</code>). <div class="language-tsx highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1>// frontend/my-app/src/features/landing/components/ConceptFormSection.tsx (Illustrative Snippet)</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=c1>// Uses ConceptForm component</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=p>&lt;</span><span class=nt>ConceptForm</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>    </span><span class=na>onSubmit</span><span class=o>=</span><span class=p>{</span><span class=nx>handleGenerateConcept</span><span class=p>}</span><span class=w> </span><span class=err>//</span><span class=w> </span><span class=na>handleGenerateConcept</span><span class=w> </span><span class=na>calls</span><span class=w> </span><span class=na>the</span><span class=w> </span><span class=na>mutation</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>    </span><span class=na>status</span><span class=o>=</span><span class=p>{</span><span class=nx>formStatus</span><span class=p>}</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>    </span><span class=err>//</span><span class=w> </span><span class=na>...</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=p>/&gt;</span>
</span></code></pre></div></li> <li>On submit, <code>useGenerateConceptMutation</code> (a React Query hook from <code>hooks/useConceptMutations.ts</code>) is invoked. <div class="language-typescript highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1>// frontend/my-app/src/hooks/useConceptMutations.ts (Illustrative Snippet)</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>useGenerateConceptMutation</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>setActiveTask</span><span class=p>,</span><span class=w> </span><span class=nx>setIsTaskInitiating</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useTaskContext</span><span class=p>();</span><span class=w> </span><span class=c1>// Assuming TaskContext hook</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>decrementLimit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRateLimitsDecrement</span><span class=p>();</span><span class=w> </span><span class=c1>// Assuming RateLimit hook</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>useMutation</span><span class=o>&lt;</span><span class=nx>TaskResponse</span><span class=p>,</span><span class=w> </span><span class=ne>Error</span><span class=p>,</span><span class=w> </span><span class=nx>PromptRequest</span><span class=o>&gt;</span><span class=p>({</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=nx>mutationFn</span><span class=o>:</span><span class=w> </span><span class=kt>async</span><span class=w> </span><span class=p>(</span><span class=nx>data</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>      </span><span class=nx>setIsTaskInitiating</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>      </span><span class=nx>decrementLimit</span><span class=p>(</span><span class=s2>&quot;generate_concept&quot;</span><span class=p>);</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>      </span><span class=kd>const</span><span class=w> </span><span class=nx>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>apiClient</span><span class=p>.</span><span class=nx>post</span><span class=o>&lt;</span><span class=nx>TaskResponse</span><span class=o>&gt;</span><span class=p>(</span><span class=nx>API_ENDPOINTS</span><span class=p>.</span><span class=nx>GENERATE_CONCEPT</span><span class=p>,</span><span class=w> </span><span class=nx>data</span><span class=p>);</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>      </span><span class=nx>setActiveTask</span><span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>task_id</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>id</span><span class=p>);</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>;</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=w>    </span><span class=c1>// ... onError, onSuccess, onSettled ...</span>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=w>  </span><span class=p>});</span>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=p>}</span>
</span></code></pre></div></li> <li>The hook:<ul> <li>Calls <code>apiClient.post</code> to the <code>/api/concepts/generate-with-palettes</code> endpoint.</li> <li>Optimistically decrements the <code>generate_concept</code> rate limit via <code>useRateLimitsDecrement</code>.</li> <li>Sets the <code>TaskContext</code> state to <code>isTaskInitiating: true</code>.</li> </ul> </li> <li>The backend API returns a <code>TaskResponse</code> with a <code>task_id</code> and <code>status: "pending"</code>.</li> <li>The <code>onSuccess</code> callback of the mutation sets this <code>task_id</code> as the <code>activeTaskId</code> in <code>TaskContext</code>. <code>isTaskInitiating</code> becomes <code>false</code>.</li> <li>The <code>TaskStatusBar</code> (subscribed to <code>TaskContext</code>) displays "Request queued...". <div class="language-tsx highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1>// frontend/my-app/src/components/TaskStatusBar.tsx (Illustrative Snippet)</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=kd>const</span><span class=w> </span><span class=nx>TaskStatusBar</span><span class=o>:</span><span class=w> </span><span class=kt>React.FC</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>activeTaskData</span><span class=p>,</span><span class=w> </span><span class=nx>isTaskInitiating</span><span class=p>,</span><span class=w> </span><span class=nx>isTaskPending</span><span class=p>,</span><span class=w> </span><span class=nx>isTaskProcessing</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useTaskContext</span><span class=p>();</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>  </span><span class=c1>// ... logic to determine message and style based on task state ...</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isTaskInitiating</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>Preparing</span><span class=p>...&lt;/</span><span class=nt>div</span><span class=p>&gt;;</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isTaskPending</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>Queued</span><span class=p>...&lt;/</span><span class=nt>div</span><span class=p>&gt;;</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>  </span><span class=c1>// ...</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=p>};</span>
</span></code></pre></div></li> <li><code>useTaskSubscription</code> (used by <code>TaskContext</code> or directly) establishes a Supabase Realtime channel for this <code>task_id</code>.</li> <li>When the backend worker updates the task status (e.g., to "processing", then "completed"), the Realtime event triggers an update in <code>TaskContext</code>.</li> <li>The UI (e.g., <code>TaskStatusBar</code>, <code>ResultsSection</code>) re-renders to reflect the new status.</li> <li>If completed, <code>latestResultId</code> in <code>TaskContext</code> is updated. The <code>ResultsSection</code> (or <code>ConceptDetailPage</code>) uses <code>useConceptDetail</code> with this ID to fetch and display the final generated concept.</li> </ol> <hr> <h2 id=3-terraform-infrastructure-as-code-for-gcp>3. Terraform: Infrastructure as Code for GCP<a class=headerlink href=#3-terraform-infrastructure-as-code-for-gcp title="Permanent link">&para;</a></h2> <p>All Google Cloud Platform (GCP) infrastructure for the Concept Visualizer is provisioned and managed using Terraform. This Infrastructure as Code (IaC) approach guarantees reproducible, version-controlled, and easily adaptable environments. We selected Terraform for its declarative syntax, comprehensive GCP provider, and robust dependency management, crucial for orchestrating our multi-component cloud architecture.</p> <h3 id=key-infrastructure-resources-design-decisions>Key Infrastructure Resources &amp; Design Decisions:<a class=headerlink href=#key-infrastructure-resources-design-decisions title="Permanent link">&para;</a></h3> <h4 id=networking>Networking<a class=headerlink href=#networking title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>terraform/network.tf</code>):</strong><ul> <li>Utilizes GCP's default VPC network for simplicity in this project. For larger-scale production deployments, a custom VPC would offer more granular control.</li> <li><strong>Firewall Rules:</strong> Implements a least-privilege approach. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># terraform/network.tf (Illustrative Snippet for API Ingress)</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_firewall&quot;</span><span class=w> </span><span class=nv>&quot;allow_api_ingress&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>  </span><span class=na>name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.naming_prefix}-allow-api-ingress&quot;</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>  </span><span class=na>network</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>data.google_compute_network.default_network.id</span><span class=c1> # Using default network</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>  </span><span class=nb>allow</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>    </span><span class=na>protocol</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;tcp&quot;</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>    </span><span class=na>ports</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;80&quot;, &quot;443&quot;</span><span class=p>]</span><span class=c1> # For HTTP/HTTPS</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>  </span><span class=na>source_ranges</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;0.0.0.0/0&quot;</span><span class=p>]</span><span class=c1> # Open to the internet; consider restricting or using a Load Balancer</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>  </span><span class=na>target_tags</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;${var.naming_prefix}-api-vm-${var.environment}&quot;</span><span class=p>]</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=p>}</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=c1># Snippet for GCP Health Checks</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=kr>data</span><span class=w> </span><span class=nc>&quot;google_netblock_ip_ranges&quot;</span><span class=w> </span><span class=nv>&quot;health_checkers&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=w>  </span><span class=na>range_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;health-checkers&quot;</span>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=p>}</span>
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_firewall&quot;</span><span class=w> </span><span class=nv>&quot;allow_gcp_health_checks_to_api&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-18><a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=c1>  # ...</span>
</span><span id=__span-24-19><a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a><span class=w>  </span><span class=na>source_ranges</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>data.google_netblock_ip_ranges.health_checkers.cidr_blocks_ipv4</span>
</span><span id=__span-24-20><a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a><span class=w>  </span><span class=na>target_tags</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;${var.naming_prefix}-api-vm-${var.environment}&quot;</span><span class=p>]</span>
</span><span id=__span-24-21><a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a><span class=p>}</span>
</span></code></pre></div> <code>allow_api_ingress</code> opens HTTP/HTTPS ports for the API VMs. <code>allow_ssh_ingress</code> (not shown for brevity) is restricted to <code>var.allow_ssh_ips</code>. Crucially, <code>allow_gcp_health_checks_to_api</code> permits Google's health checkers to reach API VMs, essential for MIG health and uptime monitoring.</li> </ul> </li> </ul> <h4 id=iam-service-accounts>IAM &amp; Service Accounts<a class=headerlink href=#iam-service-accounts title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>terraform/iam.tf</code>):</strong><ul> <li><strong>Dedicated Service Accounts:</strong> <code>api_service_account</code>, <code>worker_service_account</code>, and <code>cicd_service_account</code> are created with specific, minimal roles. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># terraform/iam.tf (Illustrative Snippet for API Service Account)</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_service_account&quot;</span><span class=w> </span><span class=nv>&quot;api_service_account&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>  </span><span class=na>project</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>  </span><span class=na>account_id</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.naming_prefix}-api-${var.environment}&quot;</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>  </span><span class=na>display_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;SA for Concept Viz API (${var.environment})&quot;</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=p>}</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_project_iam_member&quot;</span><span class=w> </span><span class=nv>&quot;api_sa_secret_accessor&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=w>  </span><span class=na>project</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=w>  </span><span class=na>role</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;roles/secretmanager.secretAccessor&quot;</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=w>  </span><span class=na>member</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;serviceAccount:${google_service_account.api_service_account.email}&quot;</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=p>}</span>
</span></code></pre></div></li> <li><strong>Workload Identity Federation:</strong> This is a key security feature. <code>google_iam_workload_identity_pool</code> and <code>google_iam_workload_identity_pool_provider</code> allow GitHub Actions workflows to impersonate the <code>cicd_service_account</code> using short-lived OIDC tokens from GitHub, eliminating the need to store long-lived GCP service account keys as GitHub secrets. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1># terraform/iam.tf (Illustrative Snippet for Workload Identity)</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_iam_workload_identity_pool&quot;</span><span class=w> </span><span class=nv>&quot;github_pool&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>  </span><span class=na>project</span><span class=w>                   </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>  </span><span class=na>workload_identity_pool_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;gh-pool-${var.environment}-${random_string.pool_suffix.result}&quot;</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=c1>  # ...</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=p>}</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_iam_workload_identity_pool_provider&quot;</span><span class=w> </span><span class=nv>&quot;github_provider&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=w>  </span><span class=na>project</span><span class=w>                            </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=w>  </span><span class=na>workload_identity_pool_id</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=nv>google_iam_workload_identity_pool.github_pool.workload_identity_pool_id</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=w>  </span><span class=na>workload_identity_pool_provider_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;gh-provider-${var.environment}&quot;</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=w>  </span><span class=nb>oidc</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=na>issuer_uri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;https://token.actions.githubusercontent.com&quot;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=w>  </span><span class=nb>attribute_mapping</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s2>&quot;google.subject&quot;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;assertion.sub&quot;</span><span class=p>,</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=w>  </span><span class=na>attribute_condition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;attribute.repository == \&quot;${var.github_repo}\&quot;&quot;</span><span class=c1> # Scoped to specific repo</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> <h4 id=compute-engine>Compute Engine<a class=headerlink href=#compute-engine title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>terraform/compute.tf</code>):</strong><ul> <li><strong>API Server:</strong> A <code>google_compute_instance_group_manager</code> (MIG) is used. Even with a <code>target_size = 1</code> (for cost-effectiveness in smaller environments), a MIG provides robust instance template management for updates and a clear path for future auto-scaling.</li> <li><code>google_compute_address.api_static_ip</code>: Ensures the API has a stable public IP.</li> <li><code>google_compute_instance_template.api_template</code>: Defines the VM configuration (Debian 11, machine type from <code>var.api_vm_machine_type</code>) and crucially references the startup script <code>terraform/scripts/startup-api.sh</code>. This script automates Docker installation, API image pulling from Artifact Registry, and container startup with environment variables fetched from instance metadata and GCP Secret Manager. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># terraform/compute.tf (Illustrative Snippet for Instance Template)</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_compute_instance_template&quot;</span><span class=w> </span><span class=nv>&quot;api_template&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=w>  </span><span class=na>project</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>  </span><span class=na>name_prefix</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.naming_prefix}-api-tpl-${var.environment}-&quot;</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=w>  </span><span class=na>machine_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.api_vm_machine_type</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=w>  </span><span class=nb>disk</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=na>source_image</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;debian-cloud/debian-11&quot;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=w>  </span><span class=nb>network_interface</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>    </span><span class=na>network</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>data.google_compute_network.default_network.id</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=w>    </span><span class=nb>access_config</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=na>nat_ip</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_compute_address.api_static_ip[0].address</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=w>  </span><span class=nb>service_account</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=w>    </span><span class=na>email</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>google_service_account.api_service_account.email</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=w>    </span><span class=na>scopes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;cloud-platform&quot;</span><span class=p>]</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=w>  </span><span class=na>metadata_startup_script</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>file</span><span class=p>(</span><span class=s2>&quot;${path.module}/scripts/startup-api.sh&quot;</span><span class=p>)</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=w>  </span><span class=nb>metadata</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=w>    </span><span class=na>environment</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=w>    </span><span class=na>naming_prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.naming_prefix</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=c1>    # Docker image URL is passed via metadata in deploy_backend.yml during instance recreation</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> <h4 id=cloud-function>Cloud Function<a class=headerlink href=#cloud-function title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>terraform/cloud_function.tf</code>, <code>terraform/cloud_function_source.tf</code>):</strong><ul> <li><strong>Worker Deployment:</strong> A <code>google_cloudfunctions2_function</code> resource defines the Gen 2 Cloud Function. Gen 2 was chosen for its native container support (essential for dependencies like OpenCV), longer execution times (up to 9 minutes, suitable for AI tasks), and more flexible eventing compared to Gen 1.</li> <li><strong>Source Handling:</strong> Terraform initially deploys the function configuration using a placeholder ZIP from <code>google_storage_bucket_object.placeholder_source_zip</code>. The actual worker's container image (built by CI/CD) is deployed by the <code>deploy_backend.yml</code> GitHub Action workflow, which directly updates the Cloud Function with the new image from Artifact Registry (<code>gcloud functions deploy ... --docker-image ...</code> or similar). Terraform primarily manages the function's immutable configuration. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1># terraform/cloud_function.tf (Illustrative Snippet)</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_cloudfunctions2_function&quot;</span><span class=w> </span><span class=nv>&quot;worker_function&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=w>  </span><span class=na>name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.naming_prefix}-worker-${var.environment}&quot;</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>  </span><span class=na>location</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>  </span><span class=nb>build_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=w>    </span><span class=na>runtime</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;python311&quot;</span><span class=c1> # Required even for container deployment</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>    </span><span class=na>entry_point</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;handle_pubsub&quot;</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=w>    </span><span class=nb>source</span><span class=w> </span><span class=p>{</span><span class=c1> # Placeholder for initial Terraform apply</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=w>      </span><span class=nb>storage_source</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=w>        </span><span class=na>bucket</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_storage_bucket.function_source_placeholder.name</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=w>        </span><span class=na>object</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_storage_bucket_object.placeholder_source_zip.name</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=w>  </span><span class=nb>service_config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=w>    </span><span class=na>max_instance_count</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>var.worker_max_instances</span>
</span><span id=__span-28-17><a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=w>    </span><span class=na>service_account_email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_service_account.worker_service_account.email</span>
</span><span id=__span-28-18><a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=w>    </span><span class=nb>environment_variables</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=na>GCP_PROJECT_ID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.project_id</span><span class=p>,</span><span class=w> </span><span class=p>...</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-28-19><a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=w>    </span><span class=nb>secret_environment_variables</span><span class=w> </span><span class=p>{</span><span class=c1> # Example for one secret</span>
</span><span id=__span-28-20><a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a><span class=w>      </span><span class=na>key</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;CONCEPT_SUPABASE_URL&quot;</span>
</span><span id=__span-28-21><a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a><span class=w>      </span><span class=na>secret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_secret_manager_secret.supabase_url.secret_id</span>
</span><span id=__span-28-22><a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a><span class=c1>      # ... other secrets ...</span>
</span><span id=__span-28-23><a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-28-24><a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-28-25><a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a><span class=w>  </span><span class=nb>event_trigger</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-26><a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a><span class=w>    </span><span class=na>trigger_region</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-28-27><a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a><span class=w>    </span><span class=na>event_type</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;google.cloud.pubsub.topic.v1.messagePublished&quot;</span>
</span><span id=__span-28-28><a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a><span class=w>    </span><span class=na>pubsub_topic</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>google_pubsub_topic.tasks_topic.id</span>
</span><span id=__span-28-29><a id=__codelineno-28-29 name=__codelineno-28-29 href=#__codelineno-28-29></a><span class=w>    </span><span class=na>retry_policy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;RETRY_POLICY_RETRY&quot;</span>
</span><span id=__span-28-30><a id=__codelineno-28-30 name=__codelineno-28-30 href=#__codelineno-28-30></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-28-31><a id=__codelineno-28-31 name=__codelineno-28-31 href=#__codelineno-28-31></a><span class=p>}</span>
</span></code></pre></div></li> <li><strong>Trigger:</strong> Configured to be triggered by messages on the <code>tasks_topic</code> Pub/Sub topic.</li> </ul> </li> </ul> <h4 id=pubsub>Pub/Sub<a class=headerlink href=#pubsub title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>terraform/pubsub.tf</code>):</strong><ul> <li><code>google_pubsub_topic.tasks_topic</code>: The central message queue for decoupling the API from the worker and enabling asynchronous task processing.</li> <li><code>google_pubsub_subscription.worker_subscription</code>: Connects the worker Cloud Function to the <code>tasks_topic</code>. It's configured with <code>enable_exactly_once_delivery = true</code> for improved message processing reliability. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># terraform/pubsub.tf (Illustrative Snippet)</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_pubsub_topic&quot;</span><span class=w> </span><span class=nv>&quot;tasks_topic&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>  </span><span class=na>name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.naming_prefix}-tasks-${var.environment}&quot;</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=p>}</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_pubsub_subscription&quot;</span><span class=w> </span><span class=nv>&quot;worker_subscription&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>  </span><span class=na>name</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.naming_prefix}-worker-sub-${var.environment}&quot;</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w>  </span><span class=na>topic</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_pubsub_topic.tasks_topic.name</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=w>  </span><span class=na>ack_deadline_seconds</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>60</span><span class=c1> # Example</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=w>  </span><span class=nb>retry_policy</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=na>minimum_backoff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;10s&quot;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=w>  </span><span class=na>enable_exactly_once_delivery</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> <h4 id=secret-manager>Secret Manager<a class=headerlink href=#secret-manager title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>terraform/secrets.tf</code>):</strong><ul> <li>Defines <code>google_secret_manager_secret</code> resources (as empty shells) for all sensitive credentials.</li> <li><code>google_secret_manager_secret_iam_member</code> grants specific service accounts (<code>api_service_account</code>, <code>worker_service_account</code>) the <code>roles/secretmanager.secretAccessor</code> role <em>only</em> for the secrets they require. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1># terraform/secrets.tf (Illustrative Snippet)</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_secret_manager_secret&quot;</span><span class=w> </span><span class=nv>&quot;supabase_url&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=w>  </span><span class=na>secret_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.naming_prefix}-supabase-url-${var.environment}&quot;</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=c1>  # ... replication ...</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=p>}</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_secret_manager_secret_iam_member&quot;</span><span class=w> </span><span class=nv>&quot;api_sa_can_access_supabase_url&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=w>  </span><span class=na>secret_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>google_secret_manager_secret.supabase_url.secret_id</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=w>  </span><span class=na>role</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;roles/secretmanager.secretAccessor&quot;</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=w>  </span><span class=na>member</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;serviceAccount:${google_service_account.api_service_account.email}&quot;</span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> <h4 id=artifact-registry>Artifact Registry<a class=headerlink href=#artifact-registry title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>terraform/artifact_registry.tf</code>):</strong><ul> <li><code>google_artifact_registry_repository.docker_repo</code>: A private Docker repository to securely store the API and worker container images built by CI/CD. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1># terraform/artifact_registry.tf (Illustrative Snippet)</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_artifact_registry_repository&quot;</span><span class=w> </span><span class=nv>&quot;docker_repo&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=w>  </span><span class=na>location</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=nv>var.region</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=w>  </span><span class=na>repository_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.naming_prefix}-docker-repo&quot;</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>  </span><span class=na>format</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;DOCKER&quot;</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> <h4 id=cloud-storage>Cloud Storage<a class=headerlink href=#cloud-storage title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>terraform/storage.tf</code>):</strong><ul> <li><code>google_storage_bucket.assets_bucket</code>: Used to store VM startup scripts (<code>terraform/scripts/startup-api.sh</code>) and potentially other non-sensitive static assets.</li> <li><strong>Terraform State Backend:</strong> The <code>main.tf</code> configures a GCS backend using a <em>manually pre-created</em> bucket (<code>var.manual_tf_state_bucket_name</code>). This is crucial for team collaboration, providing a centralized, versioned, and locked state. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1># terraform/main.tf (Backend Configuration Snippet)</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=nb>terraform</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=w>  </span><span class=kr>backend</span><span class=w> </span><span class=nv>&quot;gcs&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=c1>    # Bucket name is passed via -backend-config during init</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=w>    </span><span class=na>prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;terraform/state&quot;</span><span class=c1> # Workspace name (dev/prod) is appended automatically</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> <h4 id=monitoring>Monitoring<a class=headerlink href=#monitoring title="Permanent link">&para;</a></h4> <ul> <li><strong>(<code>terraform/monitoring.tf</code>):</strong><ul> <li><strong>Log-Based Metrics:</strong> <code>google_logging_metric.concept_task_failures</code> creates a custom metric to count specific error patterns from Cloud Function logs, enabling alerts on critical worker failures. <div class="language-hcl highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1># terraform/monitoring.tf (Illustrative Log-Based Metric Snippet)</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_logging_metric&quot;</span><span class=w> </span><span class=nv>&quot;concept_task_failures&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=w>  </span><span class=na>name</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.naming_prefix}-task-fails-${var.environment}&quot;</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>  </span><span class=na>filter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;resource.type=\&quot;cloud_function\&quot; AND resource.labels.function_name=\&quot;${google_cloudfunctions2_function.worker_function.name}\&quot; AND jsonPayload.severity=\&quot;ERROR\&quot; AND (jsonPayload.taskType=\&quot;concept_generation\&quot; OR jsonPayload.taskType=\&quot;concept_refinement\&quot;)&quot;</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>  </span><span class=nb>metric_descriptor</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=na>metric_kind</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;DELTA&quot;; value_type  = &quot;INT64&quot;</span><span class=err>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=p>}</span>
</span></code></pre></div></li> <li><strong>Alerting:</strong> <code>google_monitoring_alert_policy</code> resources define alerts (e.g., for task failures, API/Frontend unavailability) and send notifications via an email channel.</li> <li><strong>Uptime Checks:</strong> <code>google_monitoring_uptime_check_config</code> resources are set up for the API's health endpoint and the Vercel-hosted frontend URL.</li> </ul> </li> </ul> <h3 id=environment-management-deployment-scripts>Environment Management &amp; Deployment Scripts:<a class=headerlink href=#environment-management-deployment-scripts title="Permanent link">&para;</a></h3> <ul> <li>Terraform workspaces (<code>dev</code> and <code>prod</code>) isolate state and allow for different configurations per environment using <code>.tfvars</code> files (e.g., <code>environments/dev.tfvars</code>).</li> <li>The <code>scripts/gcp_apply.sh</code> orchestrates a multi-step deployment:<ol> <li><strong>IAM &amp; Secrets Shells First</strong>: Critical for dependency management.</li> <li><strong>Secret Population (<code>gcp_populate_secrets.sh</code>):</strong> Reads from local <code>.env.{environment}</code> files (e.g., <code>backend/.env.develop</code>) and populates GCP Secret Manager. This keeps secrets out of Terraform state and source control.</li> <li><strong>Full Infrastructure Apply</strong>: Deploys remaining resources.</li> <li><strong>Docker Build &amp; Push</strong>: For the API image.</li> <li><strong>VM Update/Restart</strong>: Ensures the API VM uses the new image.</li> <li><strong>Startup Script Upload (<code>upload_startup_scripts.sh</code>):</strong> Updates the VM startup script in GCS.</li> <li><strong>GitHub Secret Population (<code>gh_populate_secrets.sh</code>):</strong> Syncs Terraform outputs (like SA emails, Workload Identity Provider name) to GitHub Actions secrets.</li> <li><strong>Vercel Config Update</strong>: Modifies <code>frontend/my-app/vercel.json</code> with the API VM's new external IP and commits/pushes it, ensuring the Vercel frontend correctly proxies API requests.</li> </ol> </li> </ul> <hr> <h2 id=4-github-actions-workflows>4. GitHub Actions Workflows<a class=headerlink href=#4-github-actions-workflows title="Permanent link">&para;</a></h2> <p>GitHub Actions automates the Concept Visualizer's entire development lifecycle—from testing and builds to deployments and security scans. We chose GitHub Actions for its seamless repository integration, vast library of reusable actions, and its power in building sophisticated CI/CD pipelines directly within our version control, streamlining our development and release processes.</p> <h3 id=core-cicd-pipeline>Core CI/CD Pipeline:<a class=headerlink href=#core-cicd-pipeline title="Permanent link">&para;</a></h3> <h4 id=continuous-integration-tests>Continuous Integration tests<a class=headerlink href=#continuous-integration-tests title="Permanent link">&para;</a></h4> <ul> <li><strong><code>ci-tests.yml</code> (CI):</strong><ul> <li><strong>Triggers</strong>: Runs on pushes and pull requests to <code>main</code> and <code>develop</code> branches, and can be manually dispatched (<code>workflow_dispatch</code>).</li> <li><strong>Responsibilities</strong>:<ul> <li>Performs comprehensive <strong>backend testing</strong> (Pytest, Flake8, Mypy). <div class="language-yaml highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1># .github/workflows/ci-tests.yml (Backend Test Snippet)</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run Pytest</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">uv run pytest tests/</span><span class=w> </span><span class=c1># Assuming uv is set up</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=w>  </span><span class=nt>env</span><span class=p>:</span><span class=w> </span><span class=c1># Mock environment variables for tests</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=w>    </span><span class=nt>CONCEPT_SUPABASE_URL</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://example.supabase.co&quot;</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=w>    </span><span class=c1># ... other mock env vars ...</span>
</span></code></pre></div></li> <li>Conducts <strong>frontend testing</strong> (Vitest, ESLint, TypeScript checks). <div class="language-yaml highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c1># .github/workflows/ci-tests.yml (Frontend Test Snippet)</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run NPM Tests</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=w>  </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./frontend/my-app</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npm test</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=w>  </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=w>    </span><span class=nt>CI</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=w>    </span><span class=nt>VITE_API_URL</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://localhost:8000/api&quot;</span><span class=w> </span><span class=c1># Mock API URL</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=w>    </span><span class=c1># ... other mock env vars ...</span>
</span></code></pre></div></li> <li>If all tests and linters pass for pushes to <code>main</code> or <code>develop</code>, it <strong>builds the API Docker image</strong> and pushes it to GCP Artifact Registry. GCP authentication for this step uses Workload Identity Federation. <div class="language-yaml highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># .github/workflows/ci-tests.yml (Docker Build &amp; Push Snippet)</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Authenticate to Google Cloud</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=w>  </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">google-github-actions/auth@v2</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=w>  </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=w>    </span><span class=nt>workload_identity_provider</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.WORKLOAD_IDENTITY_PROVIDER }}</span><span class=w> </span><span class=c1># From branch logic</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=w>    </span><span class=nt>service_account</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.CICD_SERVICE_ACCOUNT_EMAIL }}</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Build and Push API Image</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=w>  </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker/build-push-action@v5</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=w>  </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=w>    </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./backend</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./backend/Dockerfile</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=w>    </span><span class=nt>push</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=w>      </span><span class=no>${{ secrets.GCP_REGION }}-docker.pkg.dev/${{ env.GCP_PROJECT_ID }}/${{ env.ARTIFACT_REGISTRY_REPO_NAME }}/concept-api-${{ env.ENVIRONMENT }}:${{ github.sha }}</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a><span class=w>      </span><span class=no>${{ secrets.GCP_REGION }}-docker.pkg.dev/${{ env.GCP_PROJECT_ID }}/${{ env.ARTIFACT_REGISTRY_REPO_NAME }}/concept-api-${{ env.ENVIRONMENT }}:latest</span>
</span></code></pre></div></li> </ul> </li> </ul> </li> </ul> <h4 id=deploy-backend>Deploy Backend<a class=headerlink href=#deploy-backend title="Permanent link">&para;</a></h4> <ul> <li><strong><code>deploy_backend.yml</code> (CD):</strong><ul> <li><strong>Triggers</strong>: Runs automatically upon the successful completion of the <code>ci-tests.yml</code> workflow on the <code>main</code> or <code>develop</code> branch (<code>workflow_run</code>).</li> <li><strong>Responsibilities</strong>:<ol> <li><strong>Environment Detection</strong>: Determines <code>dev</code> or <code>prod</code> GCP environment based on the Git branch of the triggering workflow. <div class="language-yaml highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=c1># .github/workflows/deploy_backend.yml (Environment Detection Snippet)</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Set Environment Specifics</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=w>  </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">set_env</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=w>    </span><span class=no>if [[ &quot;${{ github.event.workflow_run.head_branch || github.ref_name }}&quot; == &quot;develop&quot; ]]; then</span>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=w>      </span><span class=no>echo &quot;ENVIRONMENT=dev&quot; &gt;&gt; $GITHUB_ENV</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=w>      </span><span class=no>echo &quot;GCP_PROJECT_ID=${{ secrets.DEV_GCP_PROJECT_ID }}&quot; &gt;&gt; $GITHUB_ENV</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=w>      </span><span class=no># ... more dev secrets ...</span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=w>    </span><span class=no>elif [[ &quot;${{ github.event.workflow_run.head_branch || github.ref_name }}&quot; == &quot;main&quot; ]]; then</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=w>      </span><span class=no>echo &quot;ENVIRONMENT=prod&quot; &gt;&gt; $GITHUB_ENV</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=w>      </span><span class=no>echo &quot;GCP_PROJECT_ID=${{ secrets.PROD_GCP_PROJECT_ID }}&quot; &gt;&gt; $GITHUB_ENV</span>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a><span class=w>      </span><span class=no># ... more prod secrets ...</span>
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a><span class=w>    </span><span class=no>fi</span>
</span></code></pre></div></li> <li><strong>GCP Authentication</strong>: Securely authenticates to GCP using Workload Identity Federation.</li> <li><strong>Cloud Function Deployment</strong>: Deploys the worker Cloud Function (Gen 2). The <code>gcloud functions deploy</code> command is used, building from the source in <code>./backend</code> if no specific image is provided, or can be configured to use an image from Artifact Registry. This ensures the latest worker code is deployed. <div class="language-yaml highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1># .github/workflows/deploy_backend.yml (Cloud Function Deploy Snippet)</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deploy Cloud Function Worker</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>    </span><span class=no>FUNCTION_NAME=&quot;${{ env.NAMING_PREFIX }}-worker-${{ env.ENVIRONMENT }}&quot;</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=w>    </span><span class=no># ... set SECRETS_ARG dynamically ...</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=w>    </span><span class=no>gcloud functions deploy &quot;$FUNCTION_NAME&quot; \</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=w>      </span><span class=no>--gen2 \</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=w>      </span><span class=no>--region=&quot;${{ env.REGION }}&quot; \</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=w>      </span><span class=no>--runtime=python311 \</span>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=w>      </span><span class=no>--entry-point=handle_pubsub \</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=w>      </span><span class=no>--trigger-topic=&quot;$TASKS_TOPIC_NAME&quot; \</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=w>      </span><span class=no>--set-env-vars=&quot;...&quot; \</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=w>      </span><span class=no>--set-secrets=&quot;$SECRETS_ARG&quot; \</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=w>      </span><span class=no>--source=&quot;./backend&quot; # Or --docker-image if pre-built</span>
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=w>      </span><span class=no># ... other flags ...</span>
</span></code></pre></div></li> <li><strong>API VM Deployment/Update</strong>:<ul> <li>Creates a new <strong>instance template</strong> for the Compute Engine MIG, referencing the Docker image from Artifact Registry (pushed by <code>ci-tests.yml</code>, tagged with the commit SHA).</li> <li>Updates the MIG to use this new template, triggering a deployment strategy (e.g., rolling update) to deploy the new API version.</li> <li>Cleans up old, unused instance templates. <div class="language-yaml highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=c1># .github/workflows/deploy_backend.yml (API VM Deploy Snippet - Simplified)</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deploy API to Compute Engine MIG</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>    </span><span class=no>IMAGE_URL=&quot;${{ env.REGION }}-docker.pkg.dev/.../concept-api-${{ env.ENVIRONMENT }}:${{ github.sha }}&quot;</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=w>    </span><span class=no>TEMPLATE_NAME=&quot;${{ env.NAMING_PREFIX }}-api-tpl-$(echo &quot;${{ github.sha }}&quot; | cut -c1-8)-$(date +%Y%m%d%H%M%S)&quot;</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=w>    </span><span class=no>MIG_NAME=&quot;${{ env.NAMING_PREFIX }}-api-igm-${{ env.ENVIRONMENT }}&quot;</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=w>    </span><span class=no>gcloud compute instance-templates create &quot;$TEMPLATE_NAME&quot; \</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=w>      </span><span class=no>--image-family=debian-11 --machine-type=e2-micro \</span>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=w>      </span><span class=no>--metadata=startup-script-url=gs://...,docker-image=&quot;$IMAGE_URL&quot; \</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=w>      </span><span class=no># ... other template flags ...</span>
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=w>    </span><span class=no>gcloud compute instance-groups managed set-instance-template &quot;$MIG_NAME&quot; \</span>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=w>      </span><span class=no>--template=&quot;$TEMPLATE_NAME&quot; --zone=&quot;${{ env.GCP_ZONE }}&quot;</span>
</span><span id=__span-39-15><a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a>
</span><span id=__span-39-16><a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a><span class=w>    </span><span class=no># ... logic for rolling update / recreate ...</span>
</span><span id=__span-39-17><a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=w>    </span><span class=no># ... logic for cleaning up old templates ...</span>
</span></code></pre></div></li> </ul> </li> <li><strong>Frontend Monitoring Update</strong>:<ul> <li>Dynamically fetches the <strong>latest Vercel deployment URL</strong>.</li> <li>Uses Terraform (selecting the <code>dev</code> or <code>prod</code> workspace) to <strong>update GCP Monitoring resources</strong> (<code>google_monitoring_uptime_check_config.frontend_availability</code>, <code>google_monitoring_alert_policy.frontend_availability_failure_alert</code>) to target this new URL. <div class="language-yaml highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1># .github/workflows/deploy_backend.yml (Frontend Monitoring Update Snippet - Simplified)</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Apply/Update Frontend Monitoring Resources</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=w>  </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=w>    </span><span class=nt>VERCEL_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ steps.get_vercel_url.outputs.url }}</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=w>    </span><span class=c1># ... other TF vars ...</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=w>    </span><span class=no>CLEAN_VERCEL_HOST=$(echo &quot;$VERCEL_URL&quot; | sed -E &#39;s~^https?://~~&#39; | sed -E &#39;s~/.*$~~&#39;)</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=w>    </span><span class=no>terraform -chdir=terraform init -reconfigure -backend-config=&quot;bucket=$TF_STATE_BUCKET&quot;</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=w>    </span><span class=no>terraform -chdir=terraform workspace select &quot;${{ env.ENVIRONMENT }}&quot;</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=w>    </span><span class=no>cat &gt; terraform/temp_frontend_monitoring.tfvars &lt;&lt;EOF</span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=w>    </span><span class=no>project_id = &quot;${{ env.GCP_PROJECT_ID }}&quot;</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=w>    </span><span class=no>frontend_hostname = &quot;$CLEAN_VERCEL_HOST&quot;</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=w>    </span><span class=no># ... other necessary vars for these specific targets ...</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=w>    </span><span class=no>EOF</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=w>    </span><span class=no>terraform -chdir=terraform apply -auto-approve \</span>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=w>      </span><span class=no>-var-file=&quot;temp_frontend_monitoring.tfvars&quot; \</span>
</span><span id=__span-40-17><a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=w>      </span><span class=no>-target=google_monitoring_uptime_check_config.frontend_availability \</span>
</span><span id=__span-40-18><a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=w>      </span><span class=no>-target=google_monitoring_alert_policy.frontend_availability_failure_alert</span>
</span></code></pre></div></li> </ul> </li> </ol> </li> </ul> </li> </ul> <h4 id=playwright>Playwright<a class=headerlink href=#playwright title="Permanent link">&para;</a></h4> <ul> <li><strong><code>frontend/my-app/.github/workflows/playwright.yml</code> (Frontend E2E):</strong><ul> <li>Dedicated workflow for frontend Playwright tests.</li> <li>Jobs for functional E2E, <strong>visual regression testing</strong>, and <strong>accessibility testing</strong> (using <code>axe-core</code>). <div class="language-yaml highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1># frontend/my-app/.github/workflows/playwright.yml (Visual Regression Test Snippet)</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run visual regression tests</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">npx playwright test -c visual-regression.config.ts</span><span class=w> </span><span class=c1># Uses a specific Playwright config</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Upload visual test results</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=w>  </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=w>  </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v3</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=w>  </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">visual-regression-report</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=w>      </span><span class=no>test-results/visual-regression/</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=w>      </span><span class=no>tests/e2e/__snapshots__/ # Path to snapshots</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=security-maintenance-workflows>Security &amp; Maintenance Workflows:<a class=headerlink href=#security-maintenance-workflows title="Permanent link">&para;</a></h3> <h4 id=environment-security>Environment Security<a class=headerlink href=#environment-security title="Permanent link">&para;</a></h4> <ul> <li><strong><code>env_check.yml</code> (Environment Security):</strong><ul> <li><strong>Secret Scanning</strong>: Uses <strong>GitLeaks</strong> to scan history for committed secrets. <div class="language-yaml highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1># .github/workflows/env_check.yml (GitLeaks Snippet)</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run GitLeaks</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=w>    </span><span class=no>gitleaks detect --config=gitleaks.toml --report-format json --report-path gitleaks-report.json || true</span>
</span></code></pre></div></li> <li><strong>Example File Validation</strong>: Ensures <code>.env.example</code> files contain only placeholders.</li> </ul> </li> </ul> <h4 id=security-scan>Security Scan<a class=headerlink href=#security-scan title="Permanent link">&para;</a></h4> <ul> <li><strong><code>security_scan.yml</code> (Code &amp; Dependency Security):</strong><ul> <li><strong>Static Analysis</strong>: Runs <strong>GitHub CodeQL</strong> for Python and JavaScript/TypeScript. <div class="language-yaml highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=c1># .github/workflows/security_scan.yml (CodeQL Snippet)</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Initialize CodeQL</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=w>  </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/init@v3</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=w>  </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=w>    </span><span class=nt>languages</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.language }}</span><span class=w> </span><span class=c1># Runs for &#39;javascript&#39;, &#39;python&#39;</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Perform CodeQL Analysis</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=w>  </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/analyze@v3</span>
</span></code></pre></div></li> <li><strong>Dependency Scanning</strong>: Uses <code>safety</code> for Python and <code>npm audit</code> for the frontend.</li> </ul> </li> </ul> <h4 id=schedule-cleanup>Schedule Cleanup<a class=headerlink href=#schedule-cleanup title="Permanent link">&para;</a></h4> <ul> <li><strong><code>schedule-cleanup.yml</code> (Data Maintenance):</strong><ul> <li><strong>Scheduled Execution</strong>: Runs hourly via cron (<code>0 * * * *</code>).</li> <li><strong>Triggers Supabase Edge Function</strong>: Makes an HTTP POST to the <code>cleanup-old-data</code> Supabase Edge Function URL. <div class="language-yaml highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># .github/workflows/schedule-cleanup.yml (Curl Snippet)</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Call Cleanup Edge Function</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=w>    </span><span class=no>curl -L -X POST &#39;${{ env.SUPABASE_URL }}&#39; \ # URL set based on branch</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=w>      </span><span class=no>-H &#39;Authorization: Bearer ${{ env.SUPABASE_KEY }}&#39; \</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=w>      </span><span class=no>-H &#39;Content-Type: application/json&#39;</span>
</span></code></pre></div></li> </ul> </li> </ul> <h3 id=key-workflow-features>Key Workflow Features:<a class=headerlink href=#key-workflow-features title="Permanent link">&para;</a></h3> <ul> <li><strong>Environment-Specific Logic</strong>: Workflows dynamically select GCP project IDs, secrets, and configurations based on the Git branch (<code>develop</code> or <code>main</code>).</li> <li><strong>Artifact Management</strong>: Docker images (in Artifact Registry) and test reports (GitHub artifacts) are versioned and stored.</li> <li><strong>Permissions</strong>: Utilizes granular permissions for GitHub Actions tokens, especially for Workload Identity Federation with GCP.</li> </ul> <hr> <h2 id=external-services-integration>External Services Integration<a class=headerlink href=#external-services-integration title="Permanent link">&para;</a></h2> <p>The Concept Visualizer relies on several key external services, each playing a vital role:</p> <ul> <li><strong>Supabase:</strong> Chosen as an integrated Backend-as-a-Service (BaaS) to accelerate development.<ul> <li><strong>PostgreSQL Database:</strong> Stores application data like user information, concept metadata (prompts, descriptions, paths to stored images), color palette details, and background task statuses. Row Level Security (RLS) policies are defined in <code>pg-bucket-schema-policies.sql</code> scripts to ensure users can only access their own data.</li> <li><strong>Authentication:</strong> Manages user sign-up, login, and session handling. The frontend <code>AuthContext</code> and backend <code>AuthMiddleware</code> integrate with Supabase Auth. Anonymous authentication is supported for guest users.</li> <li><strong>Storage:</strong> Stores the actual generated image files (concepts and palette variations) in separate GCS-backed buckets (e.g., <code>concept-images-dev</code>, <code>palette-images-dev</code>). Access is controlled via RLS and signed URLs.</li> <li><strong>Edge Functions:</strong> The <code>cleanup-old-data</code> function (TypeScript, Deno runtime) is deployed to Supabase to perform scheduled data hygiene tasks (e.g., deleting concepts older than 30 days). This is triggered by a GitHub Actions cron job.</li> </ul> </li> <li><strong>JigsawStack API:</strong> This is the core AI engine for the application.<ul> <li>The backend's <code>JigsawStackClient</code> interacts with this third-party API to:<ul> <li>Generate initial logo/concept images from text prompts.</li> <li>Generate diverse color palettes based on theme descriptions.</li> <li>Refine existing images based on further user input.</li> </ul> </li> <li>Prompt engineering logic within the client enhances user inputs for better AI results.</li> </ul> </li> <li><strong>Upstash Redis:</strong> Provides a managed, serverless Redis instance.<ul> <li>Primarily used by the backend's API rate limiting system (implemented with SlowAPI). It stores request counts for different users/IPs and endpoints, enabling efficient enforcement of usage quotas. Its serverless nature simplifies management and scaling.</li> </ul> </li> <li><strong>Vercel:</strong> Hosts the static frontend application.<ul> <li>Chosen for its seamless Git integration, global CDN for fast content delivery, and easy-to-configure CI/CD for the frontend.</li> <li>The <code>vercel.json</code> file configures <strong>API rewrites/proxies</strong>, directing requests from the frontend (e.g., <code>/api/*</code>) to the backend API server running on GCP. This provides a unified domain for the application and simplifies CORS configuration. The <code>gcp_apply.sh</code> script automatically updates this file with the API VM's IP address after infrastructure changes.</li> </ul> </li> </ul> <hr> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>The Concept Visualizer stands on three technical pillars: a modern React/Vite frontend, a high-performance FastAPI backend, and a scalable GCP infrastructure defined by Terraform. Its design prioritizes asynchronous AI processing, robust security (IAM, Secret Manager), and extensive CI/CD automation via GitHub Actions. This foundation ensures a powerful AI design tool that is both user-centric and developer-efficient, with clear avenues for growth.</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../../01/23/Reddit%20AI%20Pulse%20%28Cloud%29/ class="md-footer__link md-footer__link--prev" aria-label="Previous: From Reddit to Insights: Building an AI-Powered Data Pipeline with Gemini (Cloud)"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> From Reddit to Insights: Building an AI-Powered Data Pipeline with Gemini (Cloud) </div> </div> </a> <a href=../../31/beatdebate-technical-deep-dive/ class="md-footer__link md-footer__link--next" aria-label="Next: BeatDebate — Technical Deep Dive"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> BeatDebate — Technical Deep Dive </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.linkedin.com/in/sulman-khan target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://github.com/sulmank target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../../../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=../../../../../javascripts/mathjax.js></script> <script src=../../../../../javascripts/analytics.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>